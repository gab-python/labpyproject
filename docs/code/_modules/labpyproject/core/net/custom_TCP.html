

<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>labpyproject.core.net.custom_TCP &mdash; Documentation labpyproject </title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/theme_overrides.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/language_data.js"></script>
        <script src="../../../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Recherche" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> labpyproject
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../labpyproject.html">labpyproject</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../../labpyproject.apps.html">labpyproject.apps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.html">labpyproject.apps.labpyrinthe</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.app.html">labpyproject.apps.labpyrinthe.app</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.app.app_types.html">app_types</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.app.app_types.html#classes">Classes</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.app.app_types.AppTypes.html">AppTypes</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.app.app_types.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.app.application.html">application</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.app.application.html#classes">Classes</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.app.application.AppManager.html">AppManager</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.app.application.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.html">labpyproject.apps.labpyrinthe.bus</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.html">labpyproject.apps.labpyrinthe.bus.commands</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.cmd_helper.html">cmd_helper</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.cmd_helper.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.commands.cmd_helper.CommandHelper.html">CommandHelper</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.cmd_helper.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.cmd_manager.html">cmd_manager</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.cmd_manager.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.commands.cmd_manager.CommandManager.html">CommandManager</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.cmd_manager.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.gamble_datas.html">gamble_datas</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.gamble_datas.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.commands.gamble_datas.GambleDataSet.html">GambleDataSet</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.commands.gamble_datas.GambleDataObject.html">GambleDataObject</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.commands.gamble_datas.PseudoActions.html">PseudoActions</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.commands.gamble_datas.GambleSearch.html">GambleSearch</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.gamble_datas.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.targets.html">targets</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.targets.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.commands.targets.TargetObject.html">TargetObject</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.commands.targets.TargetPath.html">TargetPath</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.commands.targets.TargetPathStep.html">TargetPathStep</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.commands.targets.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.html">labpyproject.apps.labpyrinthe.bus.helpers</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.exchange_helper.html">exchange_helper</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.exchange_helper.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.helpers.exchange_helper.ExchangeHelper.html">ExchangeHelper</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.exchange_helper.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.game_configuration.html">game_configuration</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.game_configuration.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.helpers.game_configuration.GameConfiguration.html">GameConfiguration</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.game_configuration.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.lab_generator.html">lab_generator</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.lab_generator.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.helpers.lab_generator.LabGenerator.html">LabGenerator</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.lab_generator.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.lab_manager.html">lab_manager</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.lab_manager.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.helpers.lab_manager.LabManager.html">LabManager</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.lab_manager.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.lab_parser.html">lab_parser</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.lab_parser.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.helpers.lab_parser.LabParser.html">LabParser</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.helpers.lab_parser.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.model.html">labpyproject.apps.labpyrinthe.bus.model</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.model.core_matrix.html">core_matrix</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.model.core_matrix.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.core_matrix.LabHelper.html">LabHelper</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.core_matrix.LabLevel.html">LabLevel</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.core_matrix.Matrice.html">Matrice</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.core_matrix.AnimatedLayer.html">AnimatedLayer</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.core_matrix.Case.html">Case</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.core_matrix.CaseRobot.html">CaseRobot</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.core_matrix.CaseDanger.html">CaseDanger</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.core_matrix.CaseGrenade.html">CaseGrenade</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.core_matrix.CaseAnimation.html">CaseAnimation</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.core_matrix.CaseBonus.html">CaseBonus</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.model.core_matrix.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.model.player.html">player</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.model.player.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.model.player.LabPlayer.html">LabPlayer</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.model.player.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.game_manager.html">game_manager</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.game_manager.html#classes">Classes</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.bus.game_manager.GameManager.html">GameManager</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.bus.game_manager.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.html">labpyproject.apps.labpyrinthe.gui</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.html">labpyproject.apps.labpyrinthe.gui.skinBase</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.GUIBase.html">GUIBase</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.GUIBase.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.GUIBase.GUIBase.html">GUIBase</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.GUIBase.GUIBaseNoThread.html">GUIBaseNoThread</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.GUIBase.GUIBaseThreaded.html">GUIBaseThreaded</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.GUIBase.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.colors.html">colors</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.colors.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.colors.ColorHelper.html">ColorHelper</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.colors.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.html">interfaces</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.AbstractZoneCarte.html">AbstractZoneCarte</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.AbstractZoneCommand.html">AbstractZoneCommand</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.AbstractZonePartie.html">AbstractZonePartie</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.AbstractZoneBots.html">AbstractZoneBots</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.AbstractZoneMenu.html">AbstractZoneMenu</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.AbstractScreenContent.html">AbstractScreenContent</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.AbstractScreenWait.html">AbstractScreenWait</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.AbstractSwitch.html">AbstractSwitch</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.AbstractInput.html">AbstractInput</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.interfaces.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.screen_wait_base.html">screen_wait_base</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.screen_wait_base.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.screen_wait_base.ScreenWaitBase.html">ScreenWaitBase</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.screen_wait_base.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.skin_base.html">skin_base</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.skin_base.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.skin_base.SkinBase.html">SkinBase</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.skin_base.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_bots_base.html">zone_bots_base</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_bots_base.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.zone_bots_base.ZoneBotsBase.html">ZoneBotsBase</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_bots_base.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_carte_base.html">zone_carte_base</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_carte_base.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.zone_carte_base.ZoneCarteBase.html">ZoneCarteBase</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.zone_carte_base.ItemObjectBase.html">ItemObjectBase</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_carte_base.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_command_base.html">zone_command_base</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_command_base.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.zone_command_base.ZoneCommandBase.html">ZoneCommandBase</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_command_base.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_menu_base.html">zone_menu_base</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_menu_base.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.zone_menu_base.ZoneMenuBase.html">ZoneMenuBase</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_menu_base.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_partie_base.html">zone_partie_base</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_partie_base.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinBase.zone_partie_base.ZonePartieBase.html">ZonePartieBase</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinBase.zone_partie_base.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinConsole.html">labpyproject.apps.labpyrinthe.gui.skinConsole</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinConsole.pub_helper.html">pub_helper</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinConsole.pub_helper.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinConsole.pub_helper.PublicationHelper.html">PublicationHelper</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinConsole.pub_helper.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.html">labpyproject.apps.labpyrinthe.gui.skinPygame</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.botview.html">botview</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.botview.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.botview.BotView.html">BotView</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.botview.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.footer.html">footer</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.footer.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.footer.Footer.html">Footer</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.footer.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.header.html">header</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.header.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.header.Header.html">Header</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.header.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.screen_wait.html">screen_wait</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.screen_wait.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.screen_wait.ScreenWait.html">ScreenWait</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.screen_wait.ScaledText.html">ScaledText</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.screen_wait.SimplePreloader.html">SimplePreloader</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.screen_wait.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.skinPygame.html">skinPygame</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.skinPygame.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.skinPygame.SkinPygame.html">SkinPygame</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.skinPygame.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.uitools.html">uitools</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.uitools.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.uitools.WImage.html">WImage</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.uitools.WText.html">WText</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.uitools.WEntry.html">WEntry</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.uitools.WButton.html">WButton</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.uitools.Spacer.html">Spacer</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.uitools.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_bots.html">zone_bots</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_bots.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_bots.ZoneBots.html">ZoneBots</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_bots.BotList.html">BotList</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_bots.BotItem.html">BotItem</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_bots.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_carte.html">zone_carte</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_carte.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_carte.ZoneCarte.html">ZoneCarte</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_carte.ItemObject.html">ItemObject</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_carte.CaseView.html">CaseView</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_carte.BotViewCarte.html">BotViewCarte</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_carte.ZoneDangerRobot.html">ZoneDangerRobot</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_carte.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_command.html">zone_command</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_command.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_command.ZoneCommand.html">ZoneCommand</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_command.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_menu.html">zone_menu</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_menu.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_menu.ZoneMenu.html">ZoneMenu</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_menu.MenuButton.html">MenuButton</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_menu.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_partie.html">zone_partie</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_partie.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinPygame.zone_partie.ZonePartie.html">ZonePartie</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinPygame.zone_partie.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.html">labpyproject.apps.labpyrinthe.gui.skinTkinter</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.header.html">header</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.header.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.header.Header.html">Header</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.header.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.screen_wait.html">screen_wait</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.screen_wait.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.screen_wait.ScreenWait.html">ScreenWait</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.screen_wait.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.skinTkinter.html">skinTkinter</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.skinTkinter.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.skinTkinter.SkinTkinter.html">SkinTkinter</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.skinTkinter.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.uitools.html">uitools</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.uitools.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.uitools.CustomEntry.html">CustomEntry</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.uitools.CanvasSwitch.html">CanvasSwitch</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.uitools.CanvasImage.html">CanvasImage</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.uitools.CanvasSpacer.html">CanvasSpacer</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.uitools.CanvasSeparateur.html">CanvasSeparateur</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.uitools.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_bots.html">zone_bots</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_bots.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_bots.ZoneBots.html">ZoneBots</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_bots.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_carte.html">zone_carte</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_carte.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_carte.ZoneCarte.html">ZoneCarte</a></li>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_carte.ItemObject.html">ItemObject</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_carte.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_command.html">zone_command</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_command.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_command.ZoneCommand.html">ZoneCommand</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_command.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_menu.html">zone_menu</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_menu.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_menu.ZoneMenu.html">ZoneMenu</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_menu.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_partie.html">zone_partie</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_partie.html#classes">Classes</a><ul>
<li class="toctree-l8"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_partie.ZonePartie.html">ZonePartie</a></li>
</ul>
</li>
<li class="toctree-l7"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.skinTkinter.zone_partie.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.GUIConsole.html">GUIConsole</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.GUIConsole.html#classes">Classes</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.GUIConsole.GUIConsole.html">GUIConsole</a></li>
<li class="toctree-l7"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.GUIConsole.ThreadInput.html">ThreadInput</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.GUIConsole.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.GUIPygame.html">GUIPygame</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.GUIPygame.html#classes">Classes</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.GUIPygame.GUIPygame.html">GUIPygame</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.GUIPygame.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.GUITk.html">GUITk</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.GUITk.html#classes">Classes</a><ul>
<li class="toctree-l7"><a class="reference internal" href="../../../../api/labpyproject.apps.labpyrinthe.gui.GUITk.GUITk.html">GUITk</a></li>
</ul>
</li>
<li class="toctree-l6"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.gui.GUITk.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.clientConsole.html">clientConsole</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.clientPygame.html">clientPygame</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.serverConsole.html">serverConsole</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.standaloneConsole.html">standaloneConsole</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.standalonePygame.html">standalonePygame</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.apps.labpyrinthe.standaloneTkinter.html">standaloneTkinter</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../labpyproject.core.html">labpyproject.core</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../labpyproject.core.app.html">labpyproject.core.app</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.core.app.app_components.html">app_components</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.app.app_components.html#classes">Classes</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.ThreadableComp.html">ThreadableComp</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.APPComp.html">APPComp</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.SatelliteExchangeObject.html">SatelliteExchangeObject</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.AbstractSatelliteComp.html">AbstractSatelliteComp</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.DelayedAction.html">DelayedAction</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.SatelliteComp.html">SatelliteComp</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.SatelliteCompNoThread.html">SatelliteCompNoThread</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.GUIExchangeObject.html">GUIExchangeObject</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.AbstractGUIComp.html">AbstractGUIComp</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.GUIComp.html">GUIComp</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.GUICompNoThread.html">GUICompNoThread</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.NETExchangeObject.html">NETExchangeObject</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.NETComp.html">NETComp</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.app.app_components.BUSINESSComp.html">BUSINESSComp</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.app.app_components.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../labpyproject.core.io.html">labpyproject.core.io</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.core.io.custom_IO.html">custom_IO</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.io.custom_IO.html#functions">Functions</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.io.custom_IO.get_file_list.html">get_file_list</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.io.custom_IO.load_obj_from_file.html">load_obj_from_file</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.io.custom_IO.load_text_file.html">load_text_file</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.io.custom_IO.save_obj_in_file.html">save_obj_in_file</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../labpyproject.core.net.html">labpyproject.core.net</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.core.net.custom_TCP.html">custom_TCP</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.net.custom_TCP.html#classes">Classes</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html">CustomTCPServerContainer</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.net.custom_TCP.ThreadedTCPServer.html">ThreadedTCPServer</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPRequestHandler.html">CustomTCPRequestHandler</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.net.custom_TCP.ParseDataError.html">ParseDataError</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html">CustomRequestHelper</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html">CustomTCPThreadedClient</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.net.custom_TCP.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../labpyproject.core.patterns.html">labpyproject.core.patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.core.patterns.design_patterns.html">design_patterns</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.patterns.design_patterns.html#classes">Classes</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.patterns.design_patterns.Singleton.html">Singleton</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.patterns.design_patterns.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../labpyproject.core.pygame.html">labpyproject.core.pygame</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.core.pygame.core.html">core</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.pygame.core.html#classes">Classes</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.BoxModelObject.html">BoxModelObject</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.MetricValue.html">MetricValue</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.BoundedMetricValue.html">BoundedMetricValue</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.VirtualItem.html">VirtualItem</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.VirtualContainer.html">VirtualContainer</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.CustomSprite.html">CustomSprite</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.RealContainer.html">RealContainer</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.RootContainer.html">RootContainer</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.LayerManager.html">LayerManager</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.LayerStack.html">LayerStack</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.core.LocalLayer.html">LocalLayer</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.pygame.core.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.core.pygame.events.html">events</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.pygame.events.html#classes">Classes</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.events.CustomEventManager.html">CustomEventManager</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.events.GUIEventManager.html">GUIEventManager</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.events.CustomBaseControl.html">CustomBaseControl</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.events.CustomBaseInput.html">CustomBaseInput</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.events.CustomBaseButton.html">CustomBaseButton</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.pygame.events.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.core.pygame.widgets.html">widgets</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.pygame.widgets.html#classes">Classes</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.Background.html">Background</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.Image.html">Image</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.Text.html">Text</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.Entry.html">Entry</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.TextButton.html">TextButton</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.Button.html">Button</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.Stack.html">Stack</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.HStack.html">HStack</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.VStack.html">VStack</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.Canvas.html">Canvas</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.HBox.html">HBox</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.VBox.html">VBox</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.pygame.widgets.Root.html">Root</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.pygame.widgets.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../labpyproject.core.queue.html">labpyproject.core.queue</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.core.queue.queue_tools.html">queue_tools</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.queue.queue_tools.html#classes">Classes</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.queue.queue_tools.QueueManager.html">QueueManager</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.queue.queue_tools.QueueSimpleClient.html">QueueSimpleClient</a></li>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.queue.queue_tools.QueueSwitcher.html">QueueSwitcher</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.queue.queue_tools.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../../labpyproject.core.random.html">labpyproject.core.random</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../../labpyproject.core.random.custom_random.html">custom_random</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.random.custom_random.html#classes">Classes</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../../../../api/labpyproject.core.random.custom_random.CustomRandom.html">CustomRandom</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../../../../labpyproject.core.random.custom_random.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">labpyproject</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Code du module</a> &raquo;</li>
        
      <li>labpyproject.core.net.custom_TCP</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Code source de labpyproject.core.net.custom_TCP</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">**Prototype de framework client/serveur** visant à résoudre les questions soulevées </span>
<span class="sd">dans l&#39;article : https://docs.python.org/3/howto/sockets.html</span>

<span class="sd">Protocole(s) supporté(s) : TCP</span>

<span class="sd">**Principes :**</span>

<span class="sd">* toute requète est découpée (au besoin) en blocs de taille `CustomRequestHelper.BUFFERSIZE`</span>
<span class="sd">* une &quot;couche de protocole&quot; identifie chaque bloc avec :</span>

<span class="sd">  - un prefix de bloc : `CustomRequestHelper.BLOC_PREFIX` (&#39;&#39;&lt;#bp#&gt;&#39;&#39;)</span>
<span class="sd">  - un entête : `|n° bloc/nombre de blocs|uid|nombre de caractères du message|`</span>
<span class="sd">  - la portion de message du bloc</span>
<span class="sd">  - un suffixe de bloc : `CustomRequestHelper.BLOC_SUFFIX` (&#39;&#39;&lt;#bs#&gt;&#39;&#39;)</span>
<span class="sd">  </span>
<span class="sd">* des codes (et arguments) de commande permettent de gérer : les accusés de réception</span>
<span class="sd">  (permettant de &quot;garantir&quot; la réception d&#39;un message), l&#39;identification unique d&#39;un</span>
<span class="sd">  client (uid), la communication de son adresse de réception (pour garantir le canal</span>
<span class="sd">  serveur vers client, cf limites de `ThreadedTCPServer(socketserver.ThreadingMixIn,</span>
<span class="sd">  socketserver.TCPServer)`)</span>

<span class="sd">.. admonition:: Exemple </span>

<span class="sd">   Blocs binaires échangés lors de la séquence de connection.</span>

<span class="sd">   1- Envoi d&#39;une demande d&#39;uid par le client :   </span>
<span class="sd">      b&#39;&lt;#bp#&gt;|1/1|None|18|[cmd:ASK_FOR_UID|]&lt;#bs#&gt;&#39;</span>
<span class="sd">      </span>
<span class="sd">   2- Réception du bloc par le Serveur, qui retourne l&#39;identifiant uid0 au client :</span>
<span class="sd">      b&#39;&lt;#bp#&gt;|1/1|gen_svr_id|4|uid0&lt;#bs#&gt;&#39;</span>
<span class="sd">      </span>
<span class="sd">   3- Réception du bloc par le client, qui retourne ses infos de connection :</span>
<span class="sd">      b&#39;&lt;#bp#&gt;|1/1|uid0|56|[cmd:SET_CLIENT_READ_INFOS|host=192.168.0.7&amp;port=11548]&lt;#bs#&gt;&#39;</span>
<span class="sd">      </span>
<span class="sd">   4- Réception du bloc par le serveur qui retourne un accusé de réception : </span>
<span class="sd">      b&#39;&lt;#bp#&gt;|1/1|gen_svr_id|26|[cmd:CONFIRM_RECEPTION|]56&lt;#bs#&gt;&#39;</span>
<span class="sd">      </span>
<span class="sd">   5- Réception de la confirmation par le client avec le bon nombre de caractères (56).</span>
<span class="sd">      La communication bilatérale est alors établie.</span>

<span class="sd">**Autres fonctionnalités :**</span>

<span class="sd">* possibilité de déconnecter / reconnecter les composants &quot;à chaud&quot;.</span>
<span class="sd">* détection des &quot;déconnections sauvages&quot; distantes pour limiter le nombre de</span>
<span class="sd">  reconnection et renvois. </span>
<span class="sd">* informe l&#39;application associée (`BUSINESSComp`) de l&#39;état des différentes</span>
<span class="sd">  connections et des erreurs d&#39;envoi.</span>

<span class="sd">Todo:</span>
<span class="sd">    Evolutions souhaitables:</span>
<span class="sd">    </span>
<span class="sd">    * supporter plusieurs codes, regrouper codes et msguid en entête</span>
<span class="sd">    * paralléliser les envois de requètes côté serveur (voir méthode `send` du serveur frontal)</span>
<span class="sd">    * à décliner pour les trois autres protocoles supportés par `socketserver`?</span>

<span class="sd">.. admonition:: Application concrète</span>

<span class="sd">    Dans le jeu **labpyrinthe** :</span>
<span class="sd">    </span>
<span class="sd">    **AppManager** (voir :doc:`labpyproject.apps.labpyrinthe.app.application`, </span>
<span class="sd">    dans la méthode privée `_init_network`) crée automatiquement un composant réseau </span>
<span class="sd">    (**CustomTCPServerContainer** ou **CustomTCPThreadedClient**), si l&#39;application </span>
<span class="sd">    est de type serveur (`AppManager.APP_SERVER`) ou respectivement client </span>
<span class="sd">    (`AppManager.APP_CLIENT`).  </span>
<span class="sd">     </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># imports</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">select</span>
<span class="kn">import</span> <span class="nn">socketserver</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">labpyproject.core.app</span> <span class="kn">import</span> <span class="n">app_components</span> <span class="k">as</span> <span class="n">appcomp</span>

<span class="c1"># Evite l&#39;ajout non désiré de certains imports à la doc sphinx</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;CustomTCPServerContainer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ThreadedTCPServer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CustomTCPRequestHandler&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ParseDataError&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CustomRequestHelper&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CustomTCPThreadedClient&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1"># Classes :</span>
<span class="c1">#-----&gt; Serveur &quot;frontal&quot;</span>
<div class="viewcode-block" id="CustomTCPServerContainer"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer">[docs]</a><span class="k">class</span> <span class="nc">CustomTCPServerContainer</span><span class="p">(</span><span class="n">appcomp</span><span class="o">.</span><span class="n">NETComp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Serveur &quot;frontal&quot;** (conteneur du ThreadedTCPServer).</span>

<span class="sd">    **Requètes entrantes :**   </span>
<span class="sd">    </span>
<span class="sd">    Prises en charge par l&#39;objet server (**ThreadedTCPServer**) via le</span>
<span class="sd">    handler(**CustomTCPRequestHandler**) appelant la méthode `handle_indexed_msg()` de cet objet.</span>
<span class="sd">    Ce serveur frontal transmet ensuite les données à l&#39;application associée via un mécanisme </span>
<span class="sd">    générique de Queues (ou par un handler externe sinon). </span>
<span class="sd">    Lors de la première connexion d&#39;un client, celui-ci fait une demande d&#39;identifiant unique </span>
<span class="sd">    au serveur. Cet uid permettra par la suite d&#39;identifier le client bien que son adresse </span>
<span class="sd">    distante change au fûr et à mesure de ses reconnections (cf gestion des requètes par </span>
<span class="sd">    `ThreadedTCPServer`).</span>

<span class="sd">    **Requètes sortantes (vers les clients) :**</span>
<span class="sd">    </span>
<span class="sd">    `ThreadedTCPServer` fermant les connexions entrantes après traitement, le client </span>
<span class="sd">    doit communiquer une adresse `(host, port)` qu&#39;il écoute afin que le serveur </span>
<span class="sd">    puisse l&#39;appeler. Dans ce cas le serveur se comporte comme un client et le </span>
<span class="sd">    client comme un serveur.</span>

<span class="sd">    Toutes les requètes sont codées (découpées, indéxées, envoyées) / décodées (reçues,</span>
<span class="sd">    analysées, recomposées) par l&#39;utilitaire **CustomRequestHelper** qui prend également en charge</span>
<span class="sd">    l&#39;insertion de codes et arguments de commandes pour les processus d&#39;identification des</span>
<span class="sd">    clients (uid), la communication de leur adresse d&#39;écoute (requètes sortantes) et la gestion</span>
<span class="sd">    d&#39;accusés de réception.</span>

<span class="sd">    **Logs :**</span>
<span class="sd">    </span>
<span class="sd">    Le serveur trace les données de connection avec les clients. Il enregistre</span>
<span class="sd">    également les erreurs survenues lors des connections, envois et réceptions.</span>
<span class="sd">    A chaque occurence d&#39;une action d&#39;envoi ou réception, le serveur envoie au composant</span>
<span class="sd">    business (appli métier), un dict d&#39;infos réseau via la méthode `dispatch_network_infos`.</span>

<span class="sd">    **Détection des connections clients &quot;rompues sauvagement&quot; :**</span>
<span class="sd">    </span>
<span class="sd">    A chaque survenue d&#39;une erreur (connection, envoi, réception), on l&#39;analyse afin </span>
<span class="sd">    de mettre à jour le statut du client.</span>
<span class="sd">    </span>
<span class="sd">    - S&#39;il s&#39;agit d&#39;une `OSError` on considère son degré de gravité (voir </span>
<span class="sd">      `CustomRequestHelper.ERRNO_DICT`, sous ensemble de `errno` cohérent avec les </span>
<span class="sd">      problématiques réseau). </span>
<span class="sd">      </span>
<span class="sd">          - Si l&#39;erreur est considérée comme fatale, l&#39;état du client passe à </span>
<span class="sd">            `CustomRequestHelper.STATUS_ERROR_CONNECTION`.</span>
<span class="sd">          - Sinon, l&#39;état du client passe à `CustomRequestHelper.STATUS_UNDEFINED` </span>
<span class="sd">            (client probablement déconnecté). Dans ce cas les prochaines tentatives </span>
<span class="sd">            de connection ou envoi se limiteront à un essaipour ce client. Charge à </span>
<span class="sd">            l&#39;appli métier de décider de considérer définitivement ce client comme déconnecté.</span>
<span class="sd">      </span>
<span class="sd">    - Parfois un envoi ne lève pas d&#39;erreur mais ne reçoit pas le bon accusé de réception </span>
<span class="sd">      (0 au lieu de la longueur du message envoyé). Celà peut se produire du fait d&#39;une erreur </span>
<span class="sd">      d&#39;encodage/décodage utf-8 (voir exemple ci dessous). Après </span>
<span class="sd">      `CustomRequestHelper.SEND_MAX_COUNT` tentatives infructueuses, le serveur communique </span>
<span class="sd">      le problème au composant business (voir sa méthode </span>
<span class="sd">      `NET_signal_send_error(self, exobj)`). L&#39;objet d&#39;échange contient les uids des clients </span>
<span class="sd">      en erreur, le message original et le paramètre d&#39;accusé de réception. </span>
<span class="sd">      Charge au composant business de procéder à un nouvel essai d&#39;envoi.</span>
<span class="sd">      </span>
<span class="sd">    **Exemple de problème d&#39;encodage/décodage utf-8-bytes-utf-8 :**</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">        Erreurs de décodage côté client: ::</span>
<span class="sd">            </span>
<span class="sd">            CustomRequestHelper._receive_buffer_block ne peut décoder un bloc de données binaires, il retourne :</span>
<span class="sd">            </span>
<span class="sd">            UnicodeDecodeError(&#39;utf-8&#39;, b&#39;&lt;#bp#&gt;|1/3|TCPSvr|457|[cmd:NEED_CONFIRMATION|]gamecmd=CHOOSE_GAME&amp;comuid=lpsvr_gcom1002auc&amp;uid=uid2&amp;listeniveaux=[1- La paix sur terre,2- Quasiment non violent,3- De nouveaux participants,4- Ca se corse,5- Sauve qui peut]&amp;msg_input=Choisissez un num\xc3&lt;#bs#&gt;&#39;, 249, 250, &#39;invalid continuation byte&#39;)</span>
<span class="sd">            </span>
<span class="sd">            ou encore:</span>
<span class="sd">            </span>
<span class="sd">            UnicodeDecodeError(&#39;utf-8&#39;, b&#39;&lt;#bp#&gt;|2/3|TCPSvr|457|\xa9ro de niveau pour commencer \xc3\xa0 jouer.&amp;msg_input_alt=Choisissez un niveau puis cliquez sur : \\n- partie (pour jouer) \\n- d\xc3\xa9mo (pour regarder une partie automatique)&amp;typechoix=CHOOSE_GAME&amp;comuid=lpsvr_gcom1001abs&lt;MSGUID=TCPSvr_117&lt;#bs#&gt;&#39;, 22, 23, &#39;invalid start byte&#39;)</span>
<span class="sd">            </span>
<span class="sd">            Remarque: le décodage bytes vers utf-8 est effectué de manière stricte.</span>
<span class="sd">            </span>
<span class="sd">            CustomRequestHelper.receive_indexed_request (le service de réception de requête) retourne alors au client :</span>
<span class="sd">            </span>
<span class="sd">            ParseDataError(&quot;CustomTCP._parse_request_part : invalid bloc of data&quot;)</span>
<span class="sd">            </span>
<span class="sd">            Lors de tentatives de réceptions ultérieures, le service identifiera des blocs incomplets qui ne pourront reconstituer une requète intègre, il retournera alors :</span>
<span class="sd">            </span>
<span class="sd">            ParseDataError(&quot;CustomTCP._analyse_list_mixedblocs : can&#39;t reconstruct blocs&quot;)</span>
<span class="sd">            </span>
<span class="sd">            En définitive le client retournera un accusé de réception avec pour valeur 0 indiquant une erreur de réception de données.</span>
<span class="sd">        </span>
<span class="sd">        Au bout de `CustomRequestHelper.SEND_MAX_COUNT` (15) essais, le serveur appelle `BUSINESSComp.NET_signal_send_error` (via le mécanisme générique de tâches): ::</span>
<span class="sd">        </span>
<span class="sd">            NET_signal_send_error exobj= SatelliteExchangeObject channelname=NET_CHANNEL typeexchange=SEND_ERROR</span>
<span class="sd">            *msg = gamecmd=CHOOSE_GAME&amp;comuid=lpsvr_gcom1002auc&amp;uid=uid2&amp;listeniveaux=[1- La paix sur terre,2- Quasiment non violent,3- De nouveaux participants,4- Ca se corse,5- Sauve qui peut]&amp;msg_input=Choisissez un numéro de niveau pour commencer à jouer.&amp;msg_input_alt=Choisissez un niveau puis cliquez sur : </span>
<span class="sd">            - partie (pour jouer) </span>
<span class="sd">            - démo (pour regarder une partie automatique)&amp;typechoix=CHOOSE_GAME&amp;comuid=lpsvr_gcom1001abs</span>
<span class="sd">            *confirmrecept = True</span>
<span class="sd">            *clients = [&#39;uid2&#39;]</span>
<span class="sd">            </span>
<span class="sd">            On remarque que les bytes posant problème côté client sont liés aux caractères </span>
<span class="sd">            accentués é et à.</span>
<span class="sd">            </span>
<span class="sd">        Dans cet exemple le composant métier (`GameManager` de l&#39;application Labpyrinthe) </span>
<span class="sd">        renverra au client d&#39;uid uid2 </span>
<span class="sd">        la commande de jeu `CHOOSE_GAME` qui finira par être reçue correctement </span>
<span class="sd">        (au bout de 15 puis 4 essais unitaires).</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># méthodes</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_address</span><span class="p">,</span> <span class="n">externalhandler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_connect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructeur : initie le processus de connection</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            server_address (tuple): (host, port)</span>
<span class="sd">            externalhandler (function): fonction externe appelée en fin de traitement </span>
<span class="sd">                d&#39;une requète entrante</span>
<span class="sd">            auto_connect (boolean): connection automatique à l&#39;initialisation, vrai par défaut</span>
<span class="sd">        </span>
<span class="sd">        Rq: plutôt que externalhandler, utiliser de préférence le mécanisme par défaut de Queues </span>
<span class="sd">        hérité de app_components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Init superclasse NETComp :</span>
        <span class="n">appcomp</span><span class="o">.</span><span class="n">NETComp</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># handler externe (méthode éxécutable) optionnel (communication native avec les autres composants via</span>
        <span class="c1"># un mécanisme de gestion automatique de Queues multi canaux)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span> <span class="o">=</span> <span class="n">externalhandler</span>
        <span class="c1"># dict d&#39;infos réseau :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;connection_status&quot;</span><span class="p">:</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span><span class="p">,</span>
            <span class="s2">&quot;binded&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;connect_errors&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># liste d&#39;ids uniques de messages reçus :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_received_msguids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="c1"># adresse :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_server_address</span><span class="p">(</span><span class="n">server_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binded_to_read</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># serveur uid :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uid</span> <span class="o">=</span> <span class="s2">&quot;TCPSvr&quot;</span>
        <span class="c1"># Serveur TCP interne : crée dans self.connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Accepte ou non de nouvelles connexions :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accept_new_connections</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Statut :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span>
        <span class="c1"># Création du thread associé :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_need_server_start</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_need_server_shutdown</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># thread de démarrage du serveur interne :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_thread_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_child_thread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_start_loop</span><span class="p">,</span> <span class="n">suffixname</span><span class="o">=</span><span class="s2">&quot;Svr_start&quot;</span>
        <span class="p">)</span>
        <span class="c1"># thread d&#39;arrêt du serveur interne :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_thread_stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_child_thread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_stop_loop</span><span class="p">,</span> <span class="n">suffixname</span><span class="o">=</span><span class="s2">&quot;Svr_stop&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_childthreads_count</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Incrément / uid clients :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clientincrement</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Connexion :</span>
        <span class="k">if</span> <span class="n">auto_connect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_server_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Définit l&#39;adresse du serveur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># paramètres</span>
        <span class="n">arg_host</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">arg_port</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg_address</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg_address</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg_address</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">arg_host</span> <span class="o">=</span> <span class="n">arg_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg_address</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">arg_port</span> <span class="o">=</span> <span class="n">arg_address</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># valeurs finales :</span>
        <span class="k">if</span> <span class="n">arg_host</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">arg_host</span> <span class="o">==</span> <span class="s2">&quot;localhost&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">get_ip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">arg_port</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">=</span> <span class="n">arg_port</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span><span class="p">)</span>

    <span class="c1">#-----&gt; uid</span>
    <span class="k">def</span> <span class="nf">_set_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_uid</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_get_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uid</span>

    <span class="n">uid</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_uid</span><span class="p">,</span> <span class="n">_set_uid</span><span class="p">)</span>  <span class="c1">#: identifiant unique du serveur</span>

    <span class="c1">#-----&gt; Threads de gestion du server interne :</span>
<div class="viewcode-block" id="CustomTCPServerContainer.server_start_loop"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.server_start_loop">[docs]</a>    <span class="k">def</span> <span class="nf">server_start_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Méthode run du thread de démarrage du serveur interne.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_need_server_start</span><span class="p">:</span>
                <span class="c1"># Démarrage du serveur :</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_start_server_from_thread</span><span class="p">()</span></div>

<div class="viewcode-block" id="CustomTCPServerContainer.server_stop_loop"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.server_stop_loop">[docs]</a>    <span class="k">def</span> <span class="nf">server_stop_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Méthode run du thread d&#39;arrêt du serveur interne.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_need_server_shutdown</span><span class="p">:</span>
                <span class="c1"># Fin du processus de fermeture :</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_shutdown_server_from_thread</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_shutdown_server_from_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Permet d&#39;appeler server.shutdown depuis un thread dédié à l&#39;arrêt.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># arrêt de la boucle du serveur :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="c1"># Garbage :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Marqueur :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_need_server_shutdown</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_start_server_from_thread</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Démarre server.server_forever depuis un thread dédié au démarrage.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Marqueur :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_need_server_start</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># démarrage de la boucle du serveur :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>

    <span class="c1">#-----&gt; Surcharge de appcomp.NETComp</span>
<div class="viewcode-block" id="CustomTCPServerContainer.sendFromExchangeObject"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.sendFromExchangeObject">[docs]</a>    <span class="k">def</span> <span class="nf">sendFromExchangeObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Méthode d&#39;envoi à partir des données comprises dans l&#39;objet NETExchangeObject</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (appcomp.NETExchangeObject): objet d&#39;échange</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictargs</span> <span class="o">=</span> <span class="n">exobj</span><span class="o">.</span><span class="n">dictargs</span>
        <span class="n">clients</span> <span class="o">=</span> <span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;msg&quot;</span><span class="p">]</span>
        <span class="n">confirmrecept</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;confirmrecept&quot;</span> <span class="ow">in</span> <span class="n">dictargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">confirmrecept</span> <span class="o">=</span> <span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;confirmrecept&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">clients</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomTCPServerContainer.set_address"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.set_address">[docs]</a>    <span class="k">def</span> <span class="nf">set_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Affecte l&#39;adresse d&#39;écoute du serveur / adresse d&#39;écriture du client.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (appcomp.NETExchangeObject): objet d&#39;échange avec </span>
<span class="sd">                exobj.dictargs={&quot;host&quot;:, &quot;port&quot;:}</span>
<span class="sd">        </span>
<span class="sd">        Rq : si host ne pointe pas vers &quot;localhost&quot; (ou &quot;&quot;), l&#39;ip sera déterminée</span>
<span class="sd">        via CustomRequestHelper.get_ip().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictargs</span> <span class="o">=</span> <span class="n">exobj</span><span class="o">.</span><span class="n">dictargs</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;host&quot;</span> <span class="ow">in</span> <span class="n">dictargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;port&quot;</span> <span class="ow">in</span> <span class="n">dictargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">host</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">port</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_server_address</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span></div>

<div class="viewcode-block" id="CustomTCPServerContainer.connect"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ordre de connection à l&#39;adresse pré définie ou à l&#39;adresse éventuellement</span>
<span class="sd">        indiquée dans : exobj.dictargs={&quot;host&quot;:, &quot;port&quot;:}</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (appcomp.NETExchangeObject): objet d&#39;échange</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># En fonction du statut :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Re définition éventuelle de l&#39;adresse :</span>
        <span class="k">if</span> <span class="n">exobj</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_address</span><span class="p">(</span><span class="n">exobj</span><span class="p">)</span>
        <span class="c1"># Création du serveur TCP interne :</span>
        <span class="c1"># Rq : en cas de reconnection après déconnection, réutiliser le même objet, même</span>
        <span class="c1"># après l&#39;avoir fermé soigneusement (server.server_close() pour la socket, server.shutdown()</span>
        <span class="c1"># pour le thread), conduit à l&#39;erreur (98, &#39;Adress already in use&#39;).</span>
        <span class="c1"># Pour avoir les fonctionnalités de connection/déconnection/reconnection..., on doit</span>
        <span class="c1"># donc utiliser un nouveau ThreadedTCPServer à chaque connection.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">ThreadedTCPServer</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span><span class="p">),</span>
            <span class="n">CustomTCPRequestHandler</span><span class="p">,</span>
            <span class="n">bind_and_activate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">set_container</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">allow_reuse_address</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Connexion :</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">server_bind</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">server_activate</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># état :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_ERROR_CONNECTION</span>
            <span class="c1"># log</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_errors</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="c1"># Remontée de l&#39;erreur</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Erreur de connection serveur [OSError: &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errno</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
                <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="n">strerror</span>
                <span class="o">+</span> <span class="s2">&quot;].&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># nettoyage (socket, loop server, ref server)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_close_internal</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">binded_to_read</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;binded&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span>
            <span class="c1"># Informe le composant business:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Le serveur est connecté.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># Informe les clients précédement connectés :</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_cmd_msg</span><span class="p">(</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_CONNECTED</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_to_clients</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># démarrage du serveur interne :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_internal</span><span class="p">()</span></div>

<div class="viewcode-block" id="CustomTCPServerContainer.disconnect"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Déconnexion du serveur.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (appcomp.NETExchangeObject): objet d&#39;échange</span>
<span class="sd">        </span>
<span class="sd">        Rq : on conserve self.netdict en cas de reconnection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Informe les clients :</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_cmd_msg</span><span class="p">(</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_DISCONNECTED</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_to_clients</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># Nettoyage (socket, loop server, ref server) :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_internal</span><span class="p">()</span>
        <span class="c1"># Etat :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binded_to_read</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Informe le composant business:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Le serveur est déconnecté.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomTCPServerContainer.net_shutdown"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.net_shutdown">[docs]</a>    <span class="k">def</span> <span class="nf">net_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ordre de clôture du seul composant réseau.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (appcomp.NETExchangeObject): objet d&#39;échange</span>
<span class="sd">            </span>
<span class="sd">        Rq : on ne clôt pas le process de gestion de tâches, le serveur est</span>
<span class="sd">        complètement ré initialisé, mais peut être redémarré.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_net_shutdown_internal</span><span class="p">()</span></div>

<div class="viewcode-block" id="CustomTCPServerContainer.shutdown"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.shutdown">[docs]</a>    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clôture du composant propagé par APPComp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># arrêt / ré initialisation du serveur :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_net_shutdown_internal</span><span class="p">()</span>
        <span class="c1"># générique : arrêt du process d&#39;écoute des tâches</span>
        <span class="n">appcomp</span><span class="o">.</span><span class="n">NETComp</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomTCPServerContainer.check_connections"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.check_connections">[docs]</a>    <span class="k">def</span> <span class="nf">check_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        le composant métier demande au composant réseau de vérifier </span>
<span class="sd">        sa / ses connection(s). </span>
<span class="sd">               </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (NETExchangeObject)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># envoi d&#39;un code CustomRequestHelper.PING aux clients</span>
        <span class="n">dictargs</span> <span class="o">=</span> <span class="n">exobj</span><span class="o">.</span><span class="n">dictargs</span>
        <span class="k">if</span> <span class="s2">&quot;clients&quot;</span> <span class="ow">in</span> <span class="n">dictargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">clients</span> <span class="o">=</span> <span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">mark_msg_as_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">prefix_msg_with_code</span><span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">PING</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">clients</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="c1">#-----&gt; Démarrage/arrêt internes</span>
    <span class="k">def</span> <span class="nf">_net_shutdown_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Code générque de clôture.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Informe les clients :</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_cmd_msg</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_SHUTDOWN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch_to_clients</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># Etat :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_SHUTDOWN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binded_to_read</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># suppression de la partie clients de netdict :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># Incrément / uid clients :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clientincrement</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Informe le composant business:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Le serveur est arrêté.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># Nettoyage (socket, loop server, ref server) :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_internal</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_start_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Démarre le serveur interne</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Démarrage  de la loop, depuis le thread de démarrage :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_need_server_start</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_close_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lance le processus de fermeture du serveur TCP interne.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Clôture de socket :</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># socket.close() peut engendrer une OSError (new in python 3.6)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">server_close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># log</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_errors</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="c1"># Arrêt de la loop, depuis le thread d&#39;arrêt :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_need_server_shutdown</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1">#-----&gt; Nouvelles connections</span>
<div class="viewcode-block" id="CustomTCPServerContainer.allow_new_connections"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.allow_new_connections">[docs]</a>    <span class="k">def</span> <span class="nf">allow_new_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Indique si le serveur accepte de nouvelles connections.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            allow (boolean)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">allow</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accept_new_connections</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">accept_new_connections</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="CustomTCPServerContainer.do_server_accept_new_connections"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.do_server_accept_new_connections">[docs]</a>    <span class="k">def</span> <span class="nf">do_server_accept_new_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Indique si le serveur accepte de nouvelles connections.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept_new_connections</span></div>

    <span class="c1">#-----&gt; Méthodes internes au &quot;framework&quot;</span>
    <span class="c1">#-----&gt; Réception</span>
<div class="viewcode-block" id="CustomTCPServerContainer.handle_indexed_msg"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.handle_indexed_msg">[docs]</a>    <span class="k">def</span> <span class="nf">handle_indexed_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictreceive</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Méthode de traitement des requètes entrantes.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            dictreceive (dict): dict généré par CustomRequestHelper.receive_indexed_request</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: {&quot;reply&quot;:Bool, &quot;reponse&quot;:reponse, &quot;return_code&quot;:return_code, &quot;dispatch&quot;:Bool}</span>
<span class="sd">        </span>
<span class="sd">        Reçoit le message complet associé à une requète (méthode appelée par le </span>
<span class="sd">        CustomTCPRequestHandler dans sa méthode handle).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Dans tous les cas on met à jour la liste des clients (cf reconnections) :</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span>
        <span class="n">sock</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;sock&quot;</span><span class="p">]</span>
        <span class="n">complete</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;complete&quot;</span><span class="p">]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span>
        <span class="n">msguid</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msguid&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># uid inconnu on rejete :</span>
            <span class="k">if</span> <span class="n">uid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">do_reply</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">return_code</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONNECTION_REFUSED</span>
                <span class="n">reponse</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">prefix_msg_with_code</span><span class="p">(</span>
                    <span class="s2">&quot;Connection refusée&quot;</span><span class="p">,</span> <span class="n">return_code</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;reply&quot;</span><span class="p">:</span> <span class="n">do_reply</span><span class="p">,</span>
                    <span class="s2">&quot;reponse&quot;</span><span class="p">:</span> <span class="n">reponse</span><span class="p">,</span>
                    <span class="s2">&quot;return_code&quot;</span><span class="p">:</span> <span class="n">return_code</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="c1"># client enregistré, log :</span>
            <span class="n">clt_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_address_from_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>
            <span class="n">rec_err</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rec_err</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">clt_add</span><span class="p">,</span> <span class="n">rec_err</span><span class="p">,</span> <span class="n">complete</span><span class="p">)</span>
        <span class="c1"># Traitement des commandes spéciales de la forme &quot;[cmd:CODE_CMD]&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msg&quot;</span><span class="p">]</span>
        <span class="n">code_cmd</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;code_cmd&quot;</span><span class="p">]</span>
        <span class="n">dict_args</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;dict_args&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">len_msg</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">len_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
        <span class="c1"># retour par défaut :</span>
        <span class="n">do_reply</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">reponse</span> <span class="o">=</span> <span class="n">len_msg</span>
        <span class="n">return_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># accusé de réception par défaut :</span>
        <span class="k">if</span> <span class="n">code_cmd</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">NEED_CONFIRMATION</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SET_CLIENT_READ_INFOS</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_CONNECTED</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_DISCONNECTED</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_SHUTDOWN</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="n">do_reply</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">return_code</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONFIRM_RECEPTION</span>
            <span class="n">reponse</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">prefix_msg_with_code</span><span class="p">(</span><span class="n">reponse</span><span class="p">,</span> <span class="n">return_code</span><span class="p">)</span>
        <span class="c1"># prise en charge des commandes :</span>
        <span class="k">if</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">ASK_FOR_UID</span><span class="p">:</span>
            <span class="c1"># si le serveur accepte de nouvelles connections :</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept_new_connections</span><span class="p">:</span>
                <span class="c1"># on génère un uid de client :</span>
                <span class="n">uid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_client_uid</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>
                <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uid</span>
                <span class="n">do_reply</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">reponse</span> <span class="o">=</span> <span class="n">uid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># on indique au client que la connection est refusée :</span>
                <span class="n">do_reply</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">return_code</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONNECTION_REFUSED</span>
                <span class="n">reponse</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">prefix_msg_with_code</span><span class="p">(</span>
                    <span class="s2">&quot;Connection refusée&quot;</span><span class="p">,</span> <span class="n">return_code</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SET_CLIENT_READ_INFOS</span><span class="p">:</span>
            <span class="c1"># un client identifié commpunique ses infos de connexions réciproques :</span>
            <span class="n">hostout</span> <span class="o">=</span> <span class="n">dict_args</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span>
            <span class="n">portout</span> <span class="o">=</span> <span class="n">dict_args</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_register_client_read_address</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">hostout</span><span class="p">,</span> <span class="n">portout</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_client_connect</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_CONNECTED</span><span class="p">:</span>
            <span class="c1"># le client confirme sa connection :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_client_connect</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_DISCONNECTED</span><span class="p">:</span>
            <span class="c1"># le client va se déconnecter :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_client_disconnect</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_SHUTDOWN</span><span class="p">:</span>
            <span class="c1"># le client va s&#39;arrêter définitivement :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handle_client_shutdown</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
        <span class="c1"># logs quantitatifs :</span>
        <span class="c1"># - réception</span>
        <span class="n">hasAR</span> <span class="o">=</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">NEED_CONFIRMATION</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_received_request_count</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">msguid</span><span class="p">,</span> <span class="n">hasAR</span><span class="p">)</span>
        <span class="c1"># - envoi</span>
        <span class="k">if</span> <span class="n">do_reply</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_sended_request_count</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Infos réseau -&gt; application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_infos</span><span class="p">()</span>
        <span class="c1"># retour par défaut :</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;reply&quot;</span><span class="p">:</span> <span class="n">do_reply</span><span class="p">,</span> <span class="s2">&quot;reponse&quot;</span><span class="p">:</span> <span class="n">reponse</span><span class="p">,</span> <span class="s2">&quot;return_code&quot;</span><span class="p">:</span> <span class="n">return_code</span><span class="p">}</span></div>

    <span class="c1">#-----&gt; Retour interne au framework</span>
<div class="viewcode-block" id="CustomTCPServerContainer.dispatch_to_external_handler"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.dispatch_to_external_handler">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_to_external_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictreceive</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transmission à l&#39;application associée en toute fin du traitement de la requète</span>
<span class="sd">        </span>
<span class="sd">        - de préférence via le mécanisme de Queues hérité de app_components (via queue_tools)</span>
<span class="sd">        - sinon via self.externalhandler en appel direct, s&#39;il est défini</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            dictreceive (dict): dict généré par CustomTCPRequestHandler.handle</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># params :</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span>
        <span class="n">msg_except_cmd</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msg_except_cmd&quot;</span><span class="p">]</span>
        <span class="n">code_cmd</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;code_cmd&quot;</span><span class="p">]</span>
        <span class="n">dictargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg_except_cmd</span><span class="p">,</span> <span class="s2">&quot;netcode&quot;</span><span class="p">:</span> <span class="n">code_cmd</span><span class="p">}</span>
        <span class="c1"># transmission à l&#39;application :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_queues_active</span><span class="p">():</span>
            <span class="c1"># de préférence via le mécanisme de Queues :</span>
            <span class="n">exobj</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="p">(</span>
                <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="o">.</span><span class="n">RECEIVE</span><span class="p">,</span> <span class="n">dictargs</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendTask</span><span class="p">(</span><span class="n">exobj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">):</span>
            <span class="c1"># appel direct au handler externe sinon :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">(</span><span class="n">dictargs</span><span class="p">)</span></div>

    <span class="c1">#-----&gt; Gestion des clients</span>
    <span class="k">def</span> <span class="nf">_create_client_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sock</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Génère un identifiant de client unique et l&#39;enregistre dans self.netdict[&quot;clients&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="s2">&quot;uid&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clientincrement</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
            <span class="s2">&quot;conlistin&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
            <span class="s2">&quot;hostout&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;portout&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;client_read&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;sockout&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;server_write&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;client_write&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;client_status&quot;</span><span class="p">:</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span><span class="p">,</span>
            <span class="s2">&quot;last_connect_error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;connect_send_error_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;last_send_error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;send_error_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;last_receive_error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;uncomplete_receive_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;unit_sended_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;AR_sended_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;total_sended_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;unit_received_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;AR_received_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;total_received_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span><span class="s2">&quot;conlistin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_address_from_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clientincrement</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">uid</span>

    <span class="k">def</span> <span class="nf">_get_address_from_socket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sock</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tente de déduire l&#39;adresse associée à la socket</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clt_add</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clt_add</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">getpeername</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">clt_add</span>

    <span class="k">def</span> <span class="nf">_get_status_for_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retourne le statut du client </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span><span class="s2">&quot;client_status&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_handle_client_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Active le client d&#39;uid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span>
            <span class="s2">&quot;client_status&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span>

    <span class="k">def</span> <span class="nf">_handle_client_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Désactive temporairement le client d&#39;uid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span>
            <span class="s2">&quot;client_status&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span><span class="s2">&quot;sockout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_handle_client_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Désactive définitivement le client d&#39;uid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span>
            <span class="s2">&quot;client_status&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_SHUTDOWN</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span><span class="s2">&quot;sockout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_dispatch_to_clients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Envoie msg à tous les clients</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">clients</span> <span class="o">=</span> <span class="p">[</span><span class="n">uid</span> <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">clients</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="o">=</span><span class="n">confirmrecept</span><span class="p">)</span>

    <span class="c1">#-----&gt; Envoi global et unitaire</span>
<div class="viewcode-block" id="CustomTCPServerContainer.send"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.send">[docs]</a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clients</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Envoie un message à une liste de clients avec accusé de réception.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            clients (list): liste d&#39;uid</span>
<span class="sd">            msg (str): le message à envoyer</span>
<span class="sd">            confirmrecept (boolean) : doit-t&#39;on s&#39;assurer de la réception du message </span>
<span class="sd">                (oui par défaut)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clients</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">clients</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># 1- Préparation de la requête :</span>
            <span class="c1"># identifiant unique de message :</span>
            <span class="n">msg2send</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">mark_msg_as_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="c1"># AR 1 : code de commande à ajouter?</span>
            <span class="k">if</span> <span class="n">confirmrecept</span><span class="p">:</span>
                <span class="n">msg2send</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">prefix_msg_with_code</span><span class="p">(</span>
                    <span class="n">msg2send</span><span class="p">,</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">NEED_CONFIRMATION</span>
                <span class="p">)</span>
            <span class="c1"># liste de blocs binaires :</span>
            <span class="n">msglen</span><span class="p">,</span> <span class="n">list2send</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_indexed_request</span><span class="p">(</span>
                <span class="n">msg2send</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uid</span>
            <span class="p">)</span>
            <span class="c1"># AR 2 : marqueur interne (cf code de cmd unique en V1)</span>
            <span class="n">code_cmd</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">split_cmd_and_msg</span><span class="p">(</span><span class="n">msg2send</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">code_cmd</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">NEED_CONFIRMATION</span><span class="p">,</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_CONNECTED</span><span class="p">,</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_DISCONNECTED</span><span class="p">,</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_SHUTDOWN</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="n">confirmrecept</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># 2- envois unitaires :</span>
            <span class="n">faillist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">clients</span><span class="p">:</span>
                <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_to_client</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">list2send</span><span class="p">,</span> <span class="n">msglen</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
                    <span class="c1"># on ne considère que les erreurs anormales qui ne sont</span>
                    <span class="c1"># pas liées à des erreurs de connections (mais de décodage)</span>
                    <span class="c1"># Rq : le statut du client a été mis à jour dans _send_to_client</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_status_for_client</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
                        <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span>
                    <span class="p">):</span>
                        <span class="n">faillist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
            <span class="c1"># 3- Signalement d&#39;erreurs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">faillist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logargs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
                    <span class="s2">&quot;confirmrecept&quot;</span><span class="p">:</span> <span class="n">confirmrecept</span><span class="p">,</span>
                    <span class="s2">&quot;clients&quot;</span><span class="p">:</span> <span class="n">faillist</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">exobj</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="p">(</span>
                    <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="o">.</span><span class="n">SEND_ERROR</span><span class="p">,</span> <span class="n">logargs</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sendTask</span><span class="p">(</span><span class="n">exobj</span><span class="p">)</span>
        <span class="c1"># Infos réseau -&gt; application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_infos</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_send_to_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">bytesblocs</span><span class="p">,</span> <span class="n">msglen</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Envoie une requêye indéxée au client d&#39;uid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Si le client s&#39;est déconnecté :</span>
        <span class="c1"># Rqs :</span>
        <span class="c1"># - STATUS_ERROR_CONNECTION ne peut être connu que localement (du client dans ce cas)</span>
        <span class="c1"># - STATUS_REJECTED n&#39;est mémorisé que par le client, mais celà équivaut à uid = None</span>
        <span class="c1"># en définitive on essaye d&#39;envoyer si le statut est STATUS_CONNECTED ou STATUS_UNDEFINED,</span>
        <span class="c1"># dans ce dernier cas on ne fera qu&#39;un essai.</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span>
            <span class="s2">&quot;client_status&quot;</span>
        <span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_SHUTDOWN</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_ERROR_CONNECTION</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># log dénombrement d&#39;envoi :</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_sended_request_count</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="p">)</span>
        <span class="c1"># marqueur d&#39;erreur</span>
        <span class="n">has_error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># 1- connection :</span>
        <span class="n">clientdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">]</span>
        <span class="n">send_errors</span> <span class="o">=</span> <span class="p">(</span><span class="n">clientdict</span><span class="p">[</span><span class="s2">&quot;last_connect_error&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
            <span class="n">clientdict</span><span class="p">[</span><span class="s2">&quot;last_send_error&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">sockout</span> <span class="o">=</span> <span class="n">clientdict</span><span class="p">[</span><span class="s2">&quot;sockout&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sockout</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">send_errors</span><span class="p">:</span>
            <span class="n">hostout</span> <span class="o">=</span> <span class="n">clientdict</span><span class="p">[</span><span class="s2">&quot;hostout&quot;</span><span class="p">]</span>
            <span class="n">portout</span> <span class="o">=</span> <span class="n">clientdict</span><span class="p">[</span><span class="s2">&quot;portout&quot;</span><span class="p">]</span>
            <span class="c1"># (re) création</span>
            <span class="n">sockout</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">sockout</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="c1"># (re) connection :</span>
            <span class="k">if</span> <span class="n">portout</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">connection_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">client_unsure</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">send_errors</span>
                    <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_status_for_client</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
                    <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_UNDEFINED</span>
                <span class="p">)</span>
                <span class="k">while</span> <span class="p">(</span>
                    <span class="ow">not</span> <span class="n">connected</span>
                    <span class="ow">and</span> <span class="n">connection_count</span> <span class="o">&lt;</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONNECTION_MAX_COUNT</span>
                <span class="p">):</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="c1"># Réduction du timeout si le client est incertain et après la première </span>
                    <span class="c1"># tentative infructueuse :</span>
                    <span class="k">if</span> <span class="n">client_unsure</span> <span class="ow">or</span> <span class="n">connection_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">sockout</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">RECONNECTION_TIMEOUT</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">sockout</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">hostout</span><span class="p">,</span> <span class="n">portout</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">e</span>
                        <span class="c1"># rq : à partir de python 3.3 socket.error devient OSError</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_send</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">sockout</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                        <span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="c1"># qualification de l&#39;erreur :</span>
                        <span class="n">fatal_error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">is_error_fatal</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">fatal_error</span><span class="p">:</span>
                            <span class="n">connection_count</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">RECONNECTION_DELAY</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">break</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_send</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">sockout</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="n">has_error</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
        <span class="c1"># 2- envoi :</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_error</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">send_indexed_request</span><span class="p">(</span><span class="n">sockout</span><span class="p">,</span> <span class="n">bytesblocs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_send</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                <span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_send</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># 3- test réception :</span>
            <span class="k">if</span> <span class="n">confirmrecept</span><span class="p">:</span>  <span class="c1"># and not has_error:</span>
                <span class="n">dictreceive</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">receive_indexed_request</span><span class="p">(</span><span class="n">sockout</span><span class="p">)</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span>
                <span class="n">complete</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;complete&quot;</span><span class="p">]</span>
                <span class="n">sock</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;sock&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#  réponse invalide</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">clt_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_address_from_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">clt_add</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">complete</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bytesreceived</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msg_except_cmd&quot;</span><span class="p">]</span>
                    <span class="n">code_cmd</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;code_cmd&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">code_cmd</span> <span class="o">!=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONFIRM_RECEPTION</span>
                        <span class="ow">or</span> <span class="n">bytesreceived</span> <span class="o">==</span> <span class="kc">None</span>
                        <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">bytesreceived</span><span class="p">)</span> <span class="o">!=</span> <span class="n">msglen</span>
                    <span class="p">):</span>
                        <span class="c1"># accusé de réception invalide</span>
                        <span class="n">errors</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">error</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># log quantitatif réception :</span>
                        <span class="n">msguid</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msguid&quot;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_received_request_count</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">msguid</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># 3- Gestion d&#39;erreur</span>
        <span class="k">if</span> <span class="n">has_error</span><span class="p">:</span>
            <span class="c1"># Est ce raisonnable de ré essayer ?</span>
            <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fatal_error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">is_error_fatal</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fatal_error</span><span class="p">:</span>
                    <span class="c1"># inutile : on arrête</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># Si oui, on retente dans la limite de CustomRequestHelper.SEND_MAX_COUNT</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SEND_MAX_COUNT</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">RESEND_DELAY</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_to_client</span><span class="p">(</span>
                    <span class="n">uid</span><span class="p">,</span> <span class="n">bytesblocs</span><span class="p">,</span> <span class="n">msglen</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">count</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">has_error</span>

    <span class="c1">#-----&gt; Logs :</span>
    <span class="k">def</span> <span class="nf">_register_client_read_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enregistre l&#39;adresse de réception d&#39;un client</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span><span class="s2">&quot;hostout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span><span class="s2">&quot;portout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">][</span><span class="s2">&quot;client_read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_log_connect_errors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connect_error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log des erreurs de connections propres à self.server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;connect_errors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connect_error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_client_status_on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Met à jour le statut du client en fonction de la nature de l&#39;erreur.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            uid: identifiant du client</span>
<span class="sd">            error: OSError ou ParseDataError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fatal_error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">is_error_fatal</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="n">cltdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">]</span>
                <span class="n">current_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_status_for_client</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">fatal_error</span><span class="p">:</span>
                    <span class="c1"># on passe le client en statut CustomRequestHelper.STATUS_ERROR_CONNECTION</span>
                    <span class="n">cltdict</span><span class="p">[</span>
                        <span class="s2">&quot;client_status&quot;</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_ERROR_CONNECTION</span>
                <span class="k">elif</span> <span class="n">current_status</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span><span class="p">:</span>
                    <span class="c1"># on passe le client en statut CustomRequestHelper.STATUS_UNDEFINED</span>
                    <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;client_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_UNDEFINED</span>

    <span class="k">def</span> <span class="nf">_log_connect_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">sockout</span><span class="p">,</span> <span class="n">connect_error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log du dernier essai de connection d&#39;envoi au client identifié par uid</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            uid: identifiant du client</span>
<span class="sd">            sockout : socket d&#39;envoi</span>
<span class="sd">            connect_error : None (connexion réussie) ou OSError (dernière erreur de </span>
<span class="sd">                connection en date)            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cltdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">]</span>
            <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;sockout&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sockout</span>
            <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;last_connect_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">connect_error</span>
            <span class="k">if</span> <span class="n">connect_error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;connect_send_error_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Vérification de l&#39;état du client :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_client_status_on_error</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">connect_error</span><span class="p">)</span>
            <span class="c1"># maj adresse</span>
            <span class="n">svr_write</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">sockout</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">svr_write</span> <span class="o">=</span> <span class="n">sockout</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;server_write&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">svr_write</span>

    <span class="k">def</span> <span class="nf">_log_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">send_error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log du dernier essai d&#39;envoi au client identifié par uid</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            uid: identifiant du client</span>
<span class="sd">            send_error : None (envoi réussi) ou OSError (dernière erreur d&#39;envoi en date)        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cltdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">]</span>
            <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;last_send_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">send_error</span>
            <span class="k">if</span> <span class="n">send_error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;send_error_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Vérification de l&#39;état du client :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_client_status_on_error</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">send_error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_sended_request_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">hasAR</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log les envois de requête vers le client :</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            uid: identifiant du client</span>
<span class="sd">            unit: est-ce un envoi unitaire ou bien un renvoi</span>
<span class="sd">            hasAR: si unit=True, indique si la requête nécessite un accusé de récpetion        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cltdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">]</span>
            <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;total_sended_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
                <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;unit_sended_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">hasAR</span><span class="p">:</span>
                    <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;AR_sended_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_log_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">clt_address</span><span class="p">,</span> <span class="n">receive_error</span><span class="p">,</span> <span class="n">complete</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log du dernier process de réception de requête en provenance du client</span>
<span class="sd">        identifié par uid</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            uid: identifiant du client</span>
<span class="sd">            clt_address: dernière adresse d&#39;envoi utilisée par le client</span>
<span class="sd">            receive_error:  None (réception réussie) ou OSError (dernière erreur </span>
<span class="sd">                de réception en date)            </span>
<span class="sd">            complete (Boolean): indique si la requête reçue est complète</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cltdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">]</span>
            <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;conlistin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clt_address</span><span class="p">)</span>
            <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;client_write&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clt_address</span>
            <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;last_receive_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">receive_error</span>
            <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;uncomplete_receive_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">complete</span><span class="p">)</span>
            <span class="c1"># Vérification de l&#39;état du client :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_client_status_on_error</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">receive_error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_received_request_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">msguid</span><span class="p">,</span> <span class="n">hasAR</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log les réceptions de messages envoyés par le client</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            uid: identifiant du client</span>
<span class="sd">            msguid : identifiant unique de message</span>
<span class="sd">            hasAR : un accusé de réception est-il demandé.        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">cltdict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;clients&quot;</span><span class="p">][</span><span class="n">uid</span><span class="p">]</span>
            <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;total_received_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">msguid</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">msguid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_received_msguids</span><span class="p">:</span>
                <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;unit_received_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">hasAR</span><span class="p">:</span>
                    <span class="n">cltdict</span><span class="p">[</span><span class="s2">&quot;AR_received_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">msguid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_received_msguids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_received_msguids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msguid</span><span class="p">)</span>

    <span class="c1">#-----&gt; Etat du réseau</span>
<div class="viewcode-block" id="CustomTCPServerContainer.dispatch_network_status"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.dispatch_network_status">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_network_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Informe le composant business de l&#39;état de connection principale (réception).</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): message d&#39;info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;connection_status&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
        <span class="c1"># transmission à l&#39;application :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_queues_active</span><span class="p">():</span>
            <span class="c1"># de préférence via le mécanisme de Queues :</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="o">.</span><span class="n">NET_STATUS</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_ERROR_CONNECTION</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="o">.</span><span class="n">NET_ERROR</span>
            <span class="n">exobj</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">dictargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendTask</span><span class="p">(</span><span class="n">exobj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">):</span>
            <span class="c1"># appel direct au handler externe sinon :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">(</span><span class="n">dictargs</span><span class="p">)</span>
        <span class="c1"># Infos réseau -&gt; application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_infos</span><span class="p">()</span></div>

<div class="viewcode-block" id="CustomTCPServerContainer.dispatch_network_infos"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.dispatch_network_infos">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_network_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Envoie au composant Business les infos réseau.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network_infos</span><span class="p">()</span>
        <span class="c1"># transmission à l&#39;application :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_queues_active</span><span class="p">():</span>
            <span class="c1"># de préférence via le mécanisme de Queues :</span>
            <span class="n">exobj</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="p">(</span>
                <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="o">.</span><span class="n">SET_NET_INFO</span><span class="p">,</span> <span class="n">dictargs</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendTask</span><span class="p">(</span><span class="n">exobj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">):</span>
            <span class="c1"># appel direct au handler externe sinon :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">(</span><span class="n">dictargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomTCPServerContainer.get_network_infos"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPServerContainer.html#labpyproject.core.net.custom_TCP.CustomTCPServerContainer.get_network_infos">[docs]</a>    <span class="k">def</span> <span class="nf">get_network_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retourne un dictionnaire d&#39;infos sur le serveur et les clients.</span>
<span class="sd">        Détecte les connections probablement interrompues &quot;sauvagement&quot;.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: self.netdict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Etat de la connection principale (réception) :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;connection_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;binded&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binded_to_read</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span></div></div>


<span class="c1">#-----&gt; Server &quot;réel&quot; construit à partir du package socketserver, utilisé par composition</span>
<div class="viewcode-block" id="ThreadedTCPServer"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.ThreadedTCPServer.html#labpyproject.core.net.custom_TCP.ThreadedTCPServer">[docs]</a><span class="k">class</span> <span class="nc">ThreadedTCPServer</span><span class="p">(</span><span class="n">socketserver</span><span class="o">.</span><span class="n">ThreadingMixIn</span><span class="p">,</span> <span class="n">socketserver</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serveur TCP prenant en charge chaque requète dans un thread, lui même géré dans </span>
<span class="sd">    un thread par son conteneur **CustomTCPServerContainer**.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ThreadedTCPServer.set_container"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.ThreadedTCPServer.html#labpyproject.core.net.custom_TCP.ThreadedTCPServer.set_container">[docs]</a>    <span class="k">def</span> <span class="nf">set_container</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assigne l&#39;objet container CustomTCPServerContainer</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            parent (CustomTCPServerContainer)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_container</span> <span class="o">=</span> <span class="n">parent</span></div>

<div class="viewcode-block" id="ThreadedTCPServer.get_container"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.ThreadedTCPServer.html#labpyproject.core.net.custom_TCP.ThreadedTCPServer.get_container">[docs]</a>    <span class="k">def</span> <span class="nf">get_container</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retourne l&#39;objet container CustomTCPServerContainer.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            CustomTCPServerContainer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_container</span></div></div>


<span class="c1">#-----&gt; RequestHandler personnalisé</span>
<div class="viewcode-block" id="CustomTCPRequestHandler"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPRequestHandler.html#labpyproject.core.net.custom_TCP.CustomTCPRequestHandler">[docs]</a><span class="k">class</span> <span class="nc">CustomTCPRequestHandler</span><span class="p">(</span><span class="n">socketserver</span><span class="o">.</span><span class="n">BaseRequestHandler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Objet instancié pour chaque requète entrante (gérée dans un thread par </span>
<span class="sd">    `ThreadedTCPServer`).</span>
<span class="sd">    Appelle la méthode `handle_indexed_msg()` du **CustomTCPServerContainer** </span>
<span class="sd">    conteneur.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CustomTCPRequestHandler.handle"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPRequestHandler.html#labpyproject.core.net.custom_TCP.CustomTCPRequestHandler.handle">[docs]</a>    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prend en charge une requète entrante.</span>
<span class="sd">        </span>
<span class="sd">            1. Réception des données (via CustomRequestHelper)</span>
<span class="sd">            2. Traitement du message (par le CustomTCPServerContainer associé)</span>
<span class="sd">            3. Envoi de l&#39;éventuel accusé (via CustomRequestHelper)</span>
<span class="sd">            4. Informe le composant métier du message ou d&#39;une erreur</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">:</span>
            <span class="c1"># 1- Réception des données :</span>
            <span class="n">dictreceive</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">receive_indexed_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">)</span>
            <span class="c1"># 2- Traitement du message :</span>
            <span class="n">dicthandle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span><span class="o">.</span><span class="n">handle_indexed_msg</span><span class="p">(</span><span class="n">dictreceive</span><span class="p">)</span>
            <span class="c1"># 3- On retourne la réponse (le nombre de caractères du message reçu par défaut)</span>
            <span class="k">if</span> <span class="n">dicthandle</span><span class="p">[</span><span class="s2">&quot;reply&quot;</span><span class="p">]:</span>
                <span class="c1"># Rq : cet objet n&#39;a pas accès à la ppté uid de l&#39;objet CustomTCPServerContainer</span>
                <span class="c1"># on utilise donc un identifiant générique.</span>
                <span class="n">list2send</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_indexed_request</span><span class="p">(</span>
                    <span class="n">dicthandle</span><span class="p">[</span><span class="s2">&quot;reponse&quot;</span><span class="p">],</span> <span class="s2">&quot;gen_svr_id&quot;</span>
                <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">send_indexed_request</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="n">list2send</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;AR_sended&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># 4- Appel au handler externe après l&#39;envoi de la réponse :</span>
            <span class="n">front_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">get_container</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dicthandle</span><span class="p">[</span><span class="s2">&quot;return_code&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONNECTION_REFUSED</span><span class="p">:</span>
                <span class="c1"># connexion refusée : on informe le business sans transmettre la requête</span>
                <span class="n">clt_add</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">clt_add</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;sock&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">getpeername</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;Requête de code &quot;</span>
                    <span class="o">+</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;code_cmd&quot;</span><span class="p">]</span>
                    <span class="o">+</span> <span class="s2">&quot; rejetée. </span><span class="se">\n</span><span class="s2">Connexion refusée à &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">clt_add</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">front_server</span><span class="o">.</span><span class="n">dispatch_network_status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># on transmet la requète au business</span>
                <span class="n">front_server</span><span class="o">.</span><span class="n">dispatch_to_external_handler</span><span class="p">(</span><span class="n">dictreceive</span><span class="p">)</span></div></div>


<span class="c1">#-----&gt; Exception associée à une erreur de parsing de donnée</span>
<div class="viewcode-block" id="ParseDataError"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.ParseDataError.html#labpyproject.core.net.custom_TCP.ParseDataError">[docs]</a><span class="k">class</span> <span class="nc">ParseDataError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception associée à une erreur de parsing de donnée</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructeur</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># générique</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<span class="c1">#-----&gt; Helper statique</span>
<div class="viewcode-block" id="CustomRequestHelper"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper">[docs]</a><span class="k">class</span> <span class="nc">CustomRequestHelper</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utilitaire statique proposant des services :</span>
<span class="sd">    </span>
<span class="sd">    - de support de codes et arguments de commandes</span>
<span class="sd">    - de découpage, indexation, envoi et réception de requêtes </span>
<span class="sd">    - d&#39;analyse d&#39;erreurs</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Variables statiques</span>
    <span class="c1"># Taille de buffer par défaut considérée pour les requêtes</span>
    <span class="n">BUFFERSIZE</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1">#: Taille de buffer par défaut considérée pour les requêtes</span>
    <span class="c1"># Création et compilation de la regex d&#39;interprétation des commandes</span>
    <span class="n">REGEXP_CMD</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s2">&quot;\[cmd:[A-Za-z0-9_]*\|([A-Za-z0-9_]*=[A-Za-z0-9_\.]*&amp;?)*\]&quot;</span>
    <span class="p">)</span>  <span class="c1">#: Création et compilation de la regex d&#39;interprétation des commandes</span>
    <span class="c1"># et de celle des identifiants uniques de messages :</span>
    <span class="n">REGEXP_MSGUID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="s2">&quot;&lt;MSGUID=[A-Za-z0-9_]*&gt;&quot;</span>
    <span class="p">)</span>  <span class="c1">#: Création et compilation de la regex des identifiants uniques de messages</span>
    <span class="c1"># marqueur de début de bloc</span>
    <span class="n">BLOC_PREFIX</span> <span class="o">=</span> <span class="s2">&quot;&lt;#bp#&gt;&quot;</span>  <span class="c1">#: marqueur de début de bloc</span>
    <span class="c1"># marqueur de fin de bloc</span>
    <span class="n">BLOC_SUFFIX</span> <span class="o">=</span> <span class="s2">&quot;&lt;#bs#&gt;&quot;</span>  <span class="c1">#: marqueur de fin de bloc</span>
    <span class="c1"># nombre d&#39;erreurs à partir duquel on considère une connection comme probablement inactive :</span>
    <span class="n">INACTIVE_COUNT</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1">#: nombre d&#39;erreurs à partir duquel on considère une connection comme probablement inactive</span>
    <span class="c1"># nombre max de tentatives d&#39;envoi</span>
    <span class="n">SEND_MAX_COUNT</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1">#: nombre max de tentatives d&#39;envoi</span>
    <span class="c1"># nombre max de tentatives successives de connection</span>
    <span class="n">CONNECTION_MAX_COUNT</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1">#: nombre max de tentatives successives de connection</span>
    <span class="c1"># délai avant tentative de re connection</span>
    <span class="n">RECONNECTION_DELAY</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1">#: délai avant tentative de re connection</span>
    <span class="c1"># time out de reconnection (par défaut 120 sec, on le réduit)</span>
    <span class="n">RECONNECTION_TIMEOUT</span> <span class="o">=</span> <span class="p">(</span>
        <span class="mi">10</span>  
    <span class="p">)</span> <span class="c1">#: time out de reconnection (par défaut 120 sec, on le réduit)</span>
    <span class="c1"># délai avant nouvelle tentative d&#39;envoi</span>
    <span class="n">RESEND_DELAY</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1">#: délai avant nouvelle tentative d&#39;envoi</span>
    <span class="c1"># Timeout select</span>
    <span class="n">SELECT_TIMEOUT</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1">#: Timeout select</span>
    <span class="c1"># Codes de commandes client/serveur hors problématiques de connection pures</span>
    <span class="n">CONFIRM_RECEPTION</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;CONFIRM_RECEPTION&quot;</span>  
    <span class="p">)</span> <span class="c1">#: tag un msg comme confirmation de réception</span>
    <span class="n">NEED_CONFIRMATION</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;NEED_CONFIRMATION&quot;</span>  
    <span class="p">)</span> <span class="c1">#: indique que le message nécessite un accusé de réception</span>
    <span class="n">ASK_FOR_UID</span> <span class="o">=</span> <span class="s2">&quot;ASK_FOR_UID&quot;</span>  <span class="c1">#: demande d&#39;id unique de client</span>
    <span class="n">UID_SET_BY_SERVER</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;UID_SET_BY_SERVER&quot;</span>  
    <span class="p">)</span> <span class="c1">#: pour informer BUS/externalHandler de l&#39;affectation</span>
    <span class="n">SET_CLIENT_READ_INFOS</span> <span class="o">=</span> <span class="s2">&quot;SET_CLIENT_READ_INFOS&quot;</span>  <span class="c1">#: indique les données de connexion à client.socket_read</span>
    <span class="n">PING</span> <span class="o">=</span> <span class="s2">&quot;PING&quot;</span>  <span class="c1">#: vérification de connection</span>
    <span class="c1"># Codes d&#39;état serveur (serveur -&gt; clients)</span>
    <span class="n">SERVER_CONNECTED</span> <span class="o">=</span> <span class="s2">&quot;SERVER_CONNECTED&quot;</span>  <span class="c1">#: le serveur est connecté</span>
    <span class="n">SERVER_DISCONNECTED</span> <span class="o">=</span> <span class="s2">&quot;SERVER_DISCONNECTED&quot;</span>  <span class="c1">#: le serveur se déconnecte mais ne s&#39;arrête pas totalement</span>
    <span class="n">SERVER_SHUTDOWN</span> <span class="o">=</span> <span class="s2">&quot;SERVER_SHUTDOWN&quot;</span>  <span class="c1">#: le serveur va s&#39;arrêter</span>
    <span class="c1"># Codes d&#39;état client (client -&gt; serveur)</span>
    <span class="n">CLIENT_CONNECTED</span> <span class="o">=</span> <span class="s2">&quot;CLIENT_CONNECTED&quot;</span>  <span class="c1">#: le client est connecté au serveur</span>
    <span class="n">CLIENT_DISCONNECTED</span> <span class="o">=</span> <span class="s2">&quot;CLIENT_DISCONNECTED&quot;</span>  <span class="c1">#: le serveur se déconnecte mais ne s&#39;arrête pas totalement</span>
    <span class="n">CLIENT_SHUTDOWN</span> <span class="o">=</span> <span class="s2">&quot;CLIENT_SHUTDOWN&quot;</span>  <span class="c1">#: le client va s&#39;arrêter</span>
    <span class="c1"># statut d&#39;une connection (gestion interne &amp; NET -&gt; BUS)</span>
    <span class="n">STATUS_SHUTDOWN</span> <span class="o">=</span> <span class="s2">&quot;STATUS_SHUTDOWN&quot;</span>  <span class="c1">#: arrêt définiif</span>
    <span class="n">STATUS_DISCONNECTED</span> <span class="o">=</span> <span class="s2">&quot;STATUS_DISCONNECTED&quot;</span>  <span class="c1">#: arrêt temporaire</span>
    <span class="n">STATUS_ERROR_CONNECTION</span> <span class="o">=</span> <span class="s2">&quot;STATUS_ERROR_CONNECTION&quot;</span>  <span class="c1">#: erreur</span>
    <span class="n">STATUS_UNDEFINED</span> <span class="o">=</span> <span class="s2">&quot;STATUS_UNDEFINED&quot;</span>  <span class="c1">#: probablement en erreur</span>
    <span class="n">STATUS_CONNECTED</span> <span class="o">=</span> <span class="s2">&quot;STATUS_CONNECTED&quot;</span>  <span class="c1">#: connection active</span>
    <span class="n">STATUS_REJECTED</span> <span class="o">=</span> <span class="s2">&quot;STATUS_REJECTED&quot;</span>  <span class="c1">#: connection refusée par le serveur</span>
    <span class="c1"># Refus de connection (NET -&gt; BUS)</span>
    <span class="n">CONNECTION_REFUSED</span> <span class="o">=</span> <span class="s2">&quot;CONNECTION_REFUSED&quot;</span>  <span class="c1">#: connection refusée par le serveur</span>
    <span class="c1"># incrément d&#39;uid de messages : initialisé aléatoirement</span>
    <span class="n">MSGUID_INCREMENT</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>  <span class="c1">#: incrément d&#39;uid de messages</span>
    <span class="c1"># qualification des ERRNO système et réseau</span>
    <span class="c1"># typologies d&#39;erreur</span>
    <span class="n">ERRNO_SYS</span> <span class="o">=</span> <span class="s2">&quot;ERRNO_SYS&quot;</span>  <span class="c1">#: erreur de type système</span>
    <span class="n">ERRNO_NET</span> <span class="o">=</span> <span class="s2">&quot;ERRNO_NET&quot;</span>  <span class="c1">#: erreur de type réseau</span>
    <span class="n">ERRNO_CON</span> <span class="o">=</span> <span class="s2">&quot;ERRNO_CON&quot;</span>  <span class="c1">#: erreur de type connection</span>
    <span class="n">ERRNO_SEND</span> <span class="o">=</span> <span class="s2">&quot;ERRNO_SEND&quot;</span>  <span class="c1">#: erreur d&#39;envoi</span>
    <span class="n">ERRNO_DATA</span> <span class="o">=</span> <span class="s2">&quot;ERRNO_DATA&quot;</span>  <span class="c1">#: erreur de donnée</span>
    <span class="c1"># dict de qualification des erreurs :</span>
    <span class="n">ERRNO_DICT</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">113</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EHOSTUNREACH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;No route to host&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">87</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EUSERS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Too many users&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">105</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENOBUFS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;No buffer space available&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">90</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EMSGSIZE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_DATA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Message too long&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">97</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EAFNOSUPPORT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Address family not supported by protocol&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">53</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EBADR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid request descriptor&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">112</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EHOSTDOWN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Host is down&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">96</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EPFNOSUPPORT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Protocol family not supported&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">92</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENOPROTOOPT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Protocol not available&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">77</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EBADFD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;File descriptor in bad state&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">106</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EISCONN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Transport endpoint is already connected&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">108</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ESHUTDOWN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Cannot send after transport endpoint shutdown&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">64</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENONET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Machine is not on the network&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">91</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EPROTOTYPE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Protocol wrong type for socket&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">114</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EALREADY&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Operation already in progress&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">100</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENETDOWN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Network is down&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">76</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENOTUNIQ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Name not unique on network&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">111</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ECONNREFUSED&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Connection refused&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">93</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EPROTONOSUPPORT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Protocol not supported&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">70</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ECOMM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SEND&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Communication error on send&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">121</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EREMOTEIO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Remote I/O error&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">102</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENETRESET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Network dropped connection because of reset&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">110</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ETIMEDOUT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Connection timed out&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">122</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EDQUOT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Quota exceeded&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">56</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EBADRQC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Invalid request code&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">107</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENOTCONN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Transport endpoint is not connected&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">89</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EDESTADDRREQ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Destination address required&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">103</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ECONNABORTED&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Software caused connection abort&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">101</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENETUNREACH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Network is unreachable&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">88</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENOTSOCK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Socket operation on non-socket&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">86</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ESTRPIPE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Streams pipe error&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">104</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ECONNRESET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Connection reset by peer&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">98</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EADDRINUSE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Address already in use&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">78</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EREMCHG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Remote address changed&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">85</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ERESTART&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Interrupted system call should be restarted&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">94</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ESOCKTNOSUPPORT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Socket type not supported&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">115</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EINPROGRESS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Operation now in progress&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">61</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENODATA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_DATA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;No data available&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">120</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENODATA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_DATA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;No data available&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">32</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux, windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EPIPE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Broken pipe&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">4</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux, windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EINTR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Interrupted system call&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">71</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EPROTO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Protocol error&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">134</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EPROTO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Protocol error&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux, windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ECHILD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;No child processes&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">11</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux, windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EAGAIN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Try again&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">5</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux, windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EIO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;I/O error&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">13</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux, windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EACCES&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Permission denied&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux, windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EPERM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Operation not permitted&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">14</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux, windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;EFAULT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Bad address&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">12</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux, windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENOMEM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Out of memory&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">62</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ETIME&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Timer expired&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">137</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ETIME&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Timer expired&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">6</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;linux, windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;ENXIO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;No such device or address&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10065</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEHOSTUNREACH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;No route to host&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10004</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEINTR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Interrupted system call&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10068</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEUSERS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Too many users&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10055</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAENOBUFS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;No buffer space available&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10040</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEMSGSIZE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_DATA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Message too long&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10047</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEAFNOSUPPORT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Address family not supported by protocol&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10064</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEHOSTDOWN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Host is down&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10046</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEPFNOSUPPORT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Protocol family not supported&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10042</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAENOPROTOOPT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Protocol not available&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10056</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEISCONN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Transport endpoint is already connected&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10058</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAESHUTDOWN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Cannot send after transport endpoint shutdown&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10041</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEPROTOTYPE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Protocol wrong type for socket&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10037</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEALREADY&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Operation already in progress&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10050</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAENETDOWN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Network is down&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10013</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEACCES&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Permission denied&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10061</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAECONNREFUSED&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Connection refused&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10043</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEPROTONOSUPPORT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Protocol not supported&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10052</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAENETRESET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Network dropped connection because of reset&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10060</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAETIMEDOUT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Connection timed out&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10069</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEDQUOT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Quota exceeded&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10014</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEFAULT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Bad address&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10057</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAENOTCONN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Transport endpoint is not connected&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10039</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEDESTADDRREQ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Destination address required&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10053</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAECONNABORTED&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Software caused connection abort&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10051</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAENETUNREACH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_NET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Network is unreachable&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10038</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAENOTSOCK&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Socket operation on non-socket&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10054</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAECONNRESET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Connection reset by peer&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10048</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEADDRINUSE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Address already in use&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10044</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAESOCKTNOSUPPORT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_CON&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Socket type not supported&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="mi">10036</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;os&quot;</span><span class="p">:</span> <span class="s2">&quot;windows&quot;</span><span class="p">,</span>
            <span class="s2">&quot;errno-str&quot;</span><span class="p">:</span> <span class="s2">&quot;WSAEINPROGRESS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ERRNO_SYS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fatal&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Operation now in progress&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>  <span class="c1">#: dict de qualification des erreurs</span>
    <span class="c1"># méthodes</span>
    <span class="c1">#-----&gt; Utilitaire réseau</span>
<div class="viewcode-block" id="CustomRequestHelper.get_ip"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.get_ip">[docs]</a>    <span class="k">def</span> <span class="nf">get_ip</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retourne l&#39;ip primaire, à la différence de socket.gethostbyname(socket.gethostname()) </span>
<span class="sd">        qui retourne plus systématiquement 127.0.x.1</span>
<span class="sd">        </span>
<span class="sd">        From https://stackoverflow.com/questions/166506/finding-local-ip-addresses-using-pythons-stdlib</span>
<span class="sd">        by Jamieson Becker</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># doesn&#39;t even have to be reachable</span>
            <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s2">&quot;10.255.255.255&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">IP</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">IP</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">IP</span></div>

    <span class="n">get_ip</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">get_ip</span><span class="p">)</span>

    <span class="c1">#-----&gt; Identification unique d&#39;un message :</span>
<div class="viewcode-block" id="CustomRequestHelper.mark_msg_as_unique"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.mark_msg_as_unique">[docs]</a>    <span class="k">def</span> <span class="nf">mark_msg_as_unique</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">asker</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ajoute un identifiant unique de message à msg :</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            asker : serveur ou client à l&#39;origine de la demande</span>
<span class="sd">            msg : chaine à marquer</span>
<span class="sd">        </span>
<span class="sd">        Simplification : on ajoute la marque &lt;MSGUID=valeur&gt; en fin de message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># le message est il déja marqué ?</span>
        <span class="k">if</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">REGEXP_MSGUID</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">msg</span>
        <span class="c1"># marquage :</span>
        <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">MSGUID_INCREMENT</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">asker</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">muid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">asker</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">MSGUID_INCREMENT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">muid</span> <span class="o">=</span> <span class="s2">&quot;CRH_AUTOADD&quot;</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">MSGUID_INCREMENT</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;&lt;MSGUID=&quot;</span> <span class="o">+</span> <span class="n">muid</span> <span class="o">+</span> <span class="s2">&quot;&gt;&quot;</span>
        <span class="k">return</span> <span class="n">msg</span></div>

    <span class="n">mark_msg_as_unique</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">mark_msg_as_unique</span><span class="p">)</span>

<div class="viewcode-block" id="CustomRequestHelper.split_unique_mark_and_msg"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.split_unique_mark_and_msg">[docs]</a>    <span class="k">def</span> <span class="nf">split_unique_mark_and_msg</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sépare identifiants unique de message et message initial.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msguid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">msginit</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="n">blocsuid</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">REGEXP_MSGUID</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">blocsuid</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">blocsuid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">b0</span> <span class="o">=</span> <span class="n">blocsuid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">msguid</span> <span class="o">=</span> <span class="n">b0</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">msginit</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">REGEXP_MSGUID</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">msg</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">msguid</span><span class="p">,</span> <span class="n">msginit</span></div>

    <span class="n">split_unique_mark_and_msg</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">split_unique_mark_and_msg</span><span class="p">)</span>

    <span class="c1">#-----&gt; Formatage de messages</span>
<div class="viewcode-block" id="CustomRequestHelper.prefix_msg_with_code"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.prefix_msg_with_code">[docs]</a>    <span class="k">def</span> <span class="nf">prefix_msg_with_code</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Préfixe le msg avec un entête de commande.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entete</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_cmd_msg</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entete</span> <span class="o">+</span> <span class="n">msg</span></div>

    <span class="n">prefix_msg_with_code</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">prefix_msg_with_code</span><span class="p">)</span>

<div class="viewcode-block" id="CustomRequestHelper.create_cmd_msg"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.create_cmd_msg">[docs]</a>    <span class="k">def</span> <span class="nf">create_cmd_msg</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Formate un message de commande client/serveur.</span>
<span class="sd">        </span>
<span class="sd">        Exemple d&#39;entête ajouté : ``[cmd:CODE_TEST|v1=5&amp;v2=0.0.0.0]``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;[cmd:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cle</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cle</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&amp;&quot;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;]&quot;</span>
        <span class="k">return</span> <span class="n">msg</span></div>

    <span class="n">create_cmd_msg</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">create_cmd_msg</span><span class="p">)</span>

<div class="viewcode-block" id="CustomRequestHelper.split_cmd_and_msg"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.split_cmd_and_msg">[docs]</a>    <span class="k">def</span> <span class="nf">split_cmd_and_msg</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sépare code de commande, dict d&#39;arguments et fin du message dans un message parsé.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple : code, **kwargs, msg sans cmd</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">REGEXP_CMD</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="n">fin_cmd</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
            <span class="n">code_cmd</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="n">fin_cmd</span><span class="p">]</span>
            <span class="n">fin_args</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
            <span class="n">args_cmd</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">fin_cmd</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">fin_args</span><span class="p">]</span>
            <span class="n">dict_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args_cmd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">list_kv</span> <span class="o">=</span> <span class="n">args_cmd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">elt</span> <span class="ow">in</span> <span class="n">list_kv</span><span class="p">:</span>
                    <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">elt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
                    <span class="n">dict_args</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="n">fin_msg</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">fin_args</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
            <span class="k">return</span> <span class="n">code_cmd</span><span class="p">,</span> <span class="n">dict_args</span><span class="p">,</span> <span class="n">fin_msg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">msg</span></div>

    <span class="n">split_cmd_and_msg</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">split_cmd_and_msg</span><span class="p">)</span>

    <span class="c1">#-----&gt; Envoi</span>
<div class="viewcode-block" id="CustomRequestHelper.send_indexed_request"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.send_indexed_request">[docs]</a>    <span class="k">def</span> <span class="nf">send_indexed_request</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">bytesblocs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prend en charge l&#39;envoi via la socket sock de la liste de blocs binaires </span>
<span class="sd">        listbyteblocs.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            bytesblocs: liste de blocs binaires générée par </span>
<span class="sd">                CustomRequestHelper.create_indexed_request</span>
<span class="sd">        </span>
<span class="sd">        Retourne None ou la première erreur survenue sinon (dès cette première</span>
<span class="sd">        erreur le process d&#39;envoi des blocs a été interrompu).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">_send_request_parts</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">bytesblocs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">error</span></div>

    <span class="n">send_indexed_request</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">send_indexed_request</span><span class="p">)</span>

<div class="viewcode-block" id="CustomRequestHelper.create_indexed_request"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.create_indexed_request">[docs]</a>    <span class="k">def</span> <span class="nf">create_indexed_request</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">uid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Indexe, découpe au besoin la chaine msg envoyée par l&#39;objet d&#39;id uid.</span>
<span class="sd">        </span>
<span class="sd">        Return:</span>
<span class="sd">            msglen: clef de comparaison pour AR (longueur du message), </span>
<span class="sd">            list: une liste de blocs convertis en bytes.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msglen</span><span class="p">,</span> <span class="n">list2send</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">_split_and_index_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">msglen</span><span class="p">,</span> <span class="n">list2send</span></div>

    <span class="n">create_indexed_request</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">create_indexed_request</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_split_and_index_msg</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">uniqueid</span><span class="p">,</span> <span class="n">buffsize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Découpe et indexe le message afin d&#39;envoyer n requètes (ou blocs) de taille </span>
<span class="sd">        buffsize max, avec</span>
<span class="sd">        </span>
<span class="sd">        * pour prefix avant entête CustomRequestHelper.BLOC_PREFIX soit &#39;&#39;&lt;#bp#&gt;&#39;&#39;</span>
<span class="sd">        * pour entête : ``&quot;|&quot;+n°req+&quot;/&quot;+nb req+&quot;|&quot;+uniqueid+&quot;|&quot;+len(msg)+&quot;|&quot;``</span>
<span class="sd">        * suivi de l&#39;extrait de message du bloc</span>
<span class="sd">        * pour suffixe en fin de bloc CustomRequestHelper.BLOC_SUFFIX soit &#39;&#39;&lt;#bs#&gt;&#39;&#39;</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str) : chaine de caractère (utf-8)</span>
<span class="sd">            uniqueid (str) : chaine (utf-8)</span>
<span class="sd">            buffsize (int) : taille de buffer personnalisée, par défaut </span>
<span class="sd">                CustomRequestHelper.BUFFERSIZE</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            msglen: longueur du message (nb chars)</span>
<span class="sd">            list: Retourne la liste des blocs binaires indéxés à envoyer</span>
<span class="sd">        </span>
<span class="sd">        Raise:</span>
<span class="sd">            TypeError: si msg n&#39;est pas une str</span>
<span class="sd">        </span>
<span class="sd">        Exemple :</span>
<span class="sd">        </span>
<span class="sd">        * message aléatoire de 1641 caractères envoyé par un client en 2 requètes / blocs pour une taille de </span>
<span class="sd">          buffer de 1024 (on suppose msg fait de caractères latin-1 codés sur un byte/char) :</span>
<span class="sd">          ``&lt;#bp#&gt;|1/2|uid0|1641|fcWApZt]s[...]&lt;#bs#&gt;  (bloc 1 : tel que len(bytes(bloc 1, &quot;utf-8&quot;))=buffsize=1024)``</span>
<span class="sd">          ``&lt;#bp#&gt;|2/2|uid0|1641|ycmJ@q1O[...]&lt;#bs#&gt;   (bloc 2 : du bloc précédent jusqu&#39;à la fin du msg)``</span>
<span class="sd">        * message de confirmation de 4 caractères (réception de 1641 chars) retourné par le serveur en une requète :</span>
<span class="sd">          ``&lt;#bp#&gt;|1/1|svr|4|1641&lt;#bs#&gt;``</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">buffsize</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">buffsize</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">BUFFERSIZE</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;_split_and_index_msg expect a str value for msg argument.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="n">msglen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">mybuffsize</span> <span class="o">=</span> <span class="n">buffsize</span>
        <span class="c1"># vue binaire du message :</span>
        <span class="n">b_msg</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">mv_msg</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">b_msg</span><span class="p">)</span>
        <span class="c1"># nombre de bytes du message binaire</span>
        <span class="n">msg_bytes</span> <span class="o">=</span> <span class="n">mv_msg</span><span class="o">.</span><span class="n">nbytes</span>
        <span class="c1"># 1- Evaluation du nombre de blocs à envoyer :</span>
        <span class="n">nb_blocs</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">msg_bytes</span> <span class="o">/</span> <span class="n">mybuffsize</span><span class="p">)</span>
        <span class="c1"># header générique :</span>
        <span class="n">headerprefix</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">BLOC_PREFIX</span>
        <span class="n">headergen</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">uniqueid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">msglen</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;|&quot;</span>
        <span class="c1"># footer / suffixe de fin de bloc :</span>
        <span class="n">footer</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">BLOC_SUFFIX</span>
        <span class="n">b_footer</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">footer</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">footer_bytes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_footer</span><span class="p">)</span>
        <span class="c1"># recherche du nombre de blocs nécessaores</span>
        <span class="n">finded</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">finded</span><span class="p">:</span>
            <span class="n">header_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">header_bytes</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># liste des entêtes de blocs :</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nb_blocs</span><span class="p">):</span>
                <span class="n">headerspec</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nb_blocs</span><span class="p">)</span>
                <span class="n">header</span> <span class="o">=</span> <span class="n">headerprefix</span> <span class="o">+</span> <span class="n">headerspec</span> <span class="o">+</span> <span class="n">headergen</span>
                <span class="n">b_header</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
                <span class="n">header_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b_header</span><span class="p">)</span>
                <span class="n">header_bytes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_header</span><span class="p">)</span>
            <span class="c1"># quantité totale d&#39;info en bytes</span>
            <span class="n">total_bytes</span> <span class="o">=</span> <span class="n">msg_bytes</span> <span class="o">+</span> <span class="n">header_bytes</span> <span class="o">+</span> <span class="n">nb_blocs</span> <span class="o">*</span> <span class="n">footer_bytes</span>
            <span class="c1"># test</span>
            <span class="k">if</span> <span class="n">total_bytes</span> <span class="o">&lt;=</span> <span class="n">nb_blocs</span> <span class="o">*</span> <span class="n">mybuffsize</span><span class="p">:</span>
                <span class="n">finded</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># nombre de blocs insuffisant</span>
                <span class="n">nb_blocs</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># 2- Constitution de la liste de blocs binaires à envoyer</span>
        <span class="n">returnlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">b_header</span> <span class="ow">in</span> <span class="n">header_list</span><span class="p">:</span>
            <span class="n">fix_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b_header</span><span class="p">)</span> <span class="o">+</span> <span class="n">footer_bytes</span>
            <span class="n">maxstop</span> <span class="o">=</span> <span class="n">mybuffsize</span> <span class="o">-</span> <span class="n">fix_len</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">maxstop</span><span class="p">,</span> <span class="n">msg_bytes</span><span class="p">)</span>
            <span class="n">b_sub_msg</span> <span class="o">=</span> <span class="n">b_msg</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">stop</span>
            <span class="n">b_sub_block</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">b_header</span><span class="p">,</span> <span class="n">b_sub_msg</span><span class="p">,</span> <span class="n">b_footer</span><span class="p">])</span>
            <span class="n">returnlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b_sub_block</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">msglen</span><span class="p">,</span> <span class="n">returnlist</span>

    <span class="n">_split_and_index_msg</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">_split_and_index_msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_send_request_parts</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sock</span><span class="p">,</span> <span class="n">list2send</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Envoie via la socket sock les requètes (blocs binaires) préparé(e)s par </span>
<span class="sd">        _split_and_index_msg dans la liste list2send</span>
<span class="sd">        </span>
<span class="sd">        Retourne None ou la première erreur survenue sinon (dès cette première</span>
<span class="sd">        erreur le process d&#39;envoi des blocs a été interrompu)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">list2send</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">bloc</span> <span class="o">=</span> <span class="n">list2send</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">bloc</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># rq : python 3.3 IOError devient OSError</span>
                <span class="c1"># optimisation : on arrête dès la première erreur</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">e</span>
                <span class="k">break</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">error</span>

    <span class="n">_send_request_parts</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">_send_request_parts</span><span class="p">)</span>

    <span class="c1">#-----&gt; Réception</span>
<div class="viewcode-block" id="CustomRequestHelper.receive_indexed_request"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.receive_indexed_request">[docs]</a>    <span class="k">def</span> <span class="nf">receive_indexed_request</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sock</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prend en charge la réception sur la socket sock d&#39;une série de requètes indéxées</span>
<span class="sd">        associées à un message.</span>
<span class="sd">        </span>
<span class="sd">        Retourne le dict généré par CustomRequestHelper.create_dict_receive </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listeparsedict</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>  <span class="c1"># liste de blocs parsés</span>
        <span class="n">listemixedblocs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>  <span class="c1"># liste de blocs partiels</span>
        <span class="n">listetoparse</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>  <span class="c1"># liste de blocs partiels ré aggrégés à parser</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">requestdone</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">requestvalide</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">dictdatas</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">requestdone</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">listetoparse</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># on prend le premier bloc reconstitué</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">listetoparse</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># on récupère au max CustomRequestHelper.BUFFERSIZE bytes de données</span>
                <span class="n">data</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">_receive_buffer_block</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="c1"># on tente de parser :</span>
            <span class="n">valide</span><span class="p">,</span> <span class="n">parsedict</span><span class="p">,</span> <span class="n">mixedblocs</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">_parse_request_part</span><span class="p">(</span>
                <span class="n">data</span>
            <span class="p">)</span>
            <span class="c1"># en fonction du retour :</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">valide</span><span class="p">:</span>
                <span class="c1"># erreur bloquante : on stop</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">ParseDataError</span><span class="p">(</span>
                    <span class="s2">&quot;CustomTCP._parse_request_part : invalid bloc of data&quot;</span>
                <span class="p">)</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="n">requestvalide</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">parsedict</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># un bloc complet de données a été parsé</span>
                <span class="n">parseerrors</span> <span class="o">=</span> <span class="n">parsedict</span><span class="p">[</span><span class="s2">&quot;parseerrors&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">parseerrors</span><span class="p">:</span>
                    <span class="n">requestvalide</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">errors</span> <span class="o">+=</span> <span class="n">parseerrors</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">listeparsedict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parsedict</span><span class="p">)</span>
                    <span class="p">(</span>
                        <span class="n">requestdone</span><span class="p">,</span>
                        <span class="n">dictdatas</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">_analyse_list_parsedict</span><span class="p">(</span><span class="n">listeparsedict</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">mixedblocs</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># des données de bloc mélangées ont été reçues</span>
                <span class="p">(</span>
                    <span class="n">valide</span><span class="p">,</span>
                    <span class="n">blocs_to_parse</span><span class="p">,</span>
                    <span class="n">listemixedblocs</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">_analyse_list_mixedblocs</span><span class="p">(</span>
                    <span class="n">listemixedblocs</span><span class="p">,</span> <span class="n">mixedblocs</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">valide</span><span class="p">:</span>
                    <span class="n">requestvalide</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">ParseDataError</span><span class="p">(</span>
                        <span class="s2">&quot;CustomTCP._analyse_list_mixedblocs : can&#39;t reconstruct blocs&quot;</span>
                    <span class="p">)</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">listetoparse</span> <span class="o">+=</span> <span class="n">blocs_to_parse</span>
            <span class="c1"># Test d&#39;arrêt en cas d&#39;erreur :</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">requestvalide</span><span class="p">:</span>
                <span class="n">requestdone</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># dict de retour par défaut :</span>
        <span class="k">if</span> <span class="n">dictdatas</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dictdatas</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">_analyse_list_parsedict</span><span class="p">(</span><span class="n">listeparsedict</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">requestvalide</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;requestvalide&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">requestvalide</span>
        <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;sock&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sock</span>
        <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span>
        <span class="c1"># Retour</span>
        <span class="k">return</span> <span class="n">dictdatas</span></div>

    <span class="n">receive_indexed_request</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">receive_indexed_request</span><span class="p">)</span>

<div class="viewcode-block" id="CustomRequestHelper.create_dict_receive"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.create_dict_receive">[docs]</a>    <span class="k">def</span> <span class="nf">create_dict_receive</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Génère le dictionnaire non renseigné destiné à retenir les données </span>
<span class="sd">        d&#39;une requête reçue.</span>
<span class="sd">        </span>
<span class="sd">        ::</span>
<span class="sd">            </span>
<span class="sd">            dictreceive = {</span>
<span class="sd">                    &quot;requestvalide&quot;: True,    # validité de la requête</span>
<span class="sd">                    &quot;AR_sended&quot;:False,        # accusé de réception envoyé sans erreur</span>
<span class="sd">                    &quot;sock&quot;: None,             # socket destinataire</span>
<span class="sd">                    &quot;uid&quot;: None               # uid du destinataire</span>
<span class="sd">                    &quot;msg&quot;: None,              # message reçu</span>
<span class="sd">                    &quot;listeparsedict&quot;: None,   # liste de blocs parsés (dicts)</span>
<span class="sd">                    &quot;code_cmd&quot;: None,         # code commande</span>
<span class="sd">                    &quot;dict_args&quot;: None,        # ensemble de clefs/valeurs sous forme de dict</span>
<span class="sd">                    &quot;msg_except_cmd&quot;: None,   # message sans code de commande ni uid de message</span>
<span class="sd">                    &quot;msguid&quot;: None,           # uid de message</span>
<span class="sd">                    &quot;errors&quot;: None,           # liste d&#39;erreurs</span>
<span class="sd">                    &quot;complete&quot;: False,        # indicateur de complétion</span>
<span class="sd">                    }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictreceive</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;requestvalide&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;AR_sended&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;sock&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;listeparsedict&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;code_cmd&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;dict_args&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;msg_except_cmd&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;msguid&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;complete&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">dictreceive</span></div>

    <span class="n">create_dict_receive</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">create_dict_receive</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_analyse_list_mixedblocs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bloclist</span><span class="p">,</span> <span class="n">newbloclist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyse une nouvelle liste de blocs mélangés</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">            bloclist (list): liste de blocs partiels déja identifiés</span>
<span class="sd">            newbloclist (list): nouvelle liste de blocs partiels retournée par </span>
<span class="sd">                CustomRequestHelper._parse_request_part</span>
<span class="sd">            </span>
<span class="sd">        Return:</span>
<span class="sd">            valide (bool): indique si les données sont cohérentes</span>
<span class="sd">            bloc_to_parse (list): liste de blocs complets à parser</span>
<span class="sd">            mixedblocs (list): liste de blocs incomplets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valide</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">bloc_to_parse</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">mixedblocs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="c1"># prefix et suffixe</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">BLOC_PREFIX</span>
        <span class="n">bs</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">BLOC_SUFFIX</span>
        <span class="c1"># peut on compléter le dernier bloc partiel de bloclist ?</span>
        <span class="n">prevbloc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bloclist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># il ne devrait rester au maximum qu&#39;un bloc partiel</span>
            <span class="n">valide</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">bloclist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">prevbloc</span> <span class="o">=</span> <span class="n">bloclist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># il doit avoir un prefix en entête mais pas de suffixe</span>
            <span class="n">prev_prefix</span> <span class="o">=</span> <span class="n">prevbloc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
            <span class="n">prev_no_suffix</span> <span class="o">=</span> <span class="n">prevbloc</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="n">prev_valide</span> <span class="o">=</span> <span class="n">prev_prefix</span> <span class="ow">and</span> <span class="n">prev_no_suffix</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">prev_valide</span><span class="p">:</span>
                <span class="n">valide</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># bloc valide,</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newbloclist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">nextbloc</span> <span class="o">=</span> <span class="n">newbloclist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">next_suffix</span> <span class="o">=</span> <span class="n">nextbloc</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
                    <span class="n">next_no_prefix</span> <span class="o">=</span> <span class="n">nextbloc</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                    <span class="n">next_valide</span> <span class="o">=</span> <span class="n">next_suffix</span> <span class="ow">and</span> <span class="n">next_no_prefix</span>
                    <span class="k">if</span> <span class="n">next_valide</span><span class="p">:</span>
                        <span class="c1"># on retire les deux blocs des listes</span>
                        <span class="n">prevbloc</span> <span class="o">=</span> <span class="n">bloclist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">nextbloc</span> <span class="o">=</span> <span class="n">newbloclist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="c1"># on ajoute leur concaténation à la liste à parser</span>
                        <span class="n">bloc_to_parse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prevbloc</span> <span class="o">+</span> <span class="n">nextbloc</span><span class="p">)</span>
        <span class="c1"># existe t&#39;il d&#39;autres blocs complets dans newbloclist ?</span>
        <span class="k">for</span> <span class="n">bloc</span> <span class="ow">in</span> <span class="n">newbloclist</span><span class="p">:</span>
            <span class="n">has_prefix</span> <span class="o">=</span> <span class="n">bloc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
            <span class="n">has_suffix</span> <span class="o">=</span> <span class="n">bloc</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">has_prefix</span> <span class="ow">and</span> <span class="n">has_suffix</span><span class="p">:</span>
                <span class="n">bloc_to_parse</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bloc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mixedblocs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bloc</span><span class="p">)</span>
        <span class="c1"># retour :</span>
        <span class="k">return</span> <span class="n">valide</span><span class="p">,</span> <span class="n">bloc_to_parse</span><span class="p">,</span> <span class="n">mixedblocs</span>

    <span class="n">_analyse_list_mixedblocs</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">_analyse_list_mixedblocs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_analyse_list_parsedict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">listeparsedict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyse une liste de dict de parsing de blocs de requête</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            listeparsedict (list): liste de dict de parsing sans erreur générés </span>
<span class="sd">                par CustomRequestHelper._parse_request_part</span>
<span class="sd">        </span>
<span class="sd">        Return :</span>
<span class="sd">            complete(bool): indique si la requête est complète</span>
<span class="sd">            dictdatas (dict): le dict retourné par CustomRequestHelper.receive_indexed_request</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">complete</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">dictdatas</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_dict_receive</span><span class="p">()</span>
        <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;listeparsedict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">listeparsedict</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">listeparsedict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># analyse du premier bloc :</span>
            <span class="n">parsedict</span> <span class="o">=</span> <span class="n">listeparsedict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nbr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">parsedict</span><span class="p">[</span><span class="s2">&quot;nbr&quot;</span><span class="p">])</span>  <span class="c1"># nombre de blocs de la requête complète</span>
            <span class="n">uniqueid</span> <span class="o">=</span> <span class="n">parsedict</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">uniqueid</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
                <span class="n">uniqueid</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniqueid</span>
            <span class="c1"># requête reçue complètement ?</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">nbr</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">listeparsedict</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nbr</span><span class="p">):</span>
                <span class="n">complete</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># si oui on reconstitue le message :</span>
            <span class="k">if</span> <span class="n">complete</span><span class="p">:</span>
                <span class="nb">sorted</span><span class="p">(</span><span class="n">listeparsedict</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">bloc</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">bloc</span><span class="p">[</span><span class="s2">&quot;numr&quot;</span><span class="p">]))</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">bloc</span> <span class="ow">in</span> <span class="n">listeparsedict</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="n">bloc</span><span class="p">[</span><span class="s2">&quot;msgpart&quot;</span><span class="p">]</span>
                <span class="c1"># Traitement des commandes spéciales de la forme &quot;[cmd:CODE_CMD|var=val&amp;...]&quot;</span>
                <span class="n">code_cmd</span><span class="p">,</span> <span class="n">dict_args</span><span class="p">,</span> <span class="n">fin_msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">split_cmd_and_msg</span><span class="p">(</span>
                    <span class="n">msg</span>
                <span class="p">)</span>
                <span class="c1"># Extraction de l&#39;id unique de message et du message original :</span>
                <span class="n">msguid</span><span class="p">,</span> <span class="n">fin_msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">split_unique_mark_and_msg</span><span class="p">(</span><span class="n">fin_msg</span><span class="p">)</span>
                <span class="c1"># données à retourner :</span>
                <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;msg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>
                <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;code_cmd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code_cmd</span>
                <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;dict_args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict_args</span>
                <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;msg_except_cmd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fin_msg</span>
                <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;msguid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msguid</span>
                <span class="n">dictdatas</span><span class="p">[</span><span class="s2">&quot;complete&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">complete</span>
        <span class="c1"># retour :</span>
        <span class="k">return</span> <span class="n">complete</span><span class="p">,</span> <span class="n">dictdatas</span>

    <span class="n">_analyse_list_parsedict</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">_analyse_list_parsedict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_receive_buffer_block</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">sock</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traite la récepion d&#39;un bloc de données de taille CustomRequestHelper.BUFFERSIZE.</span>
<span class="sd">        </span>
<span class="sd">        Retourne le tupple : data, error avec</span>

<span class="sd">        * data (str) : données converties en str</span>
<span class="sd">        * error (OSError, UnicodeDecodeError) : erreur éventuelle survenue   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bytesdata</span> <span class="o">=</span> <span class="n">data</span> <span class="o">=</span> <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># réception :</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bytesdata</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">BUFFERSIZE</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># rq : python 3.3 socket.error devient OSError</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">e</span>
        <span class="c1"># conversion :</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bytesdata</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">e</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">error</span>

    <span class="n">_receive_buffer_block</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">_receive_buffer_block</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_parse_request_part</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">requestpart</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traite une partie (ou bloc) de requête générée par _split_and_index_msg</span>
<span class="sd">        </span>
<span class="sd">        Retourne le tupple : valide, parsedict, mixedblocs</span>
<span class="sd">        </span>
<span class="sd">            - valide (bool): False si la données est nulle</span>
<span class="sd">            - parsedict (dict): les infos du bloc s&#39;il est complet ou None</span>
<span class="sd">            - blocslist (list): une liste de blocs ou parties de blocs </span>
<span class="sd">                (avec prefix et ou suffix) ou None</span>
<span class="sd">        </span>
<span class="sd">        Avec parsedict:    {parseerrors:bool,</span>
<span class="sd">                            numr:n°requête, </span>
<span class="sd">                            nbr:nb requêtes, </span>
<span class="sd">                            uid:uniqueid, </span>
<span class="sd">                            msglen:totalmsglen, </span>
<span class="sd">                            msgpart:msgpart}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valide</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">parsedict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">blocslist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">requestpart</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]:</span>
            <span class="c1"># Des données sont exploitables</span>
            <span class="n">valide</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># En fonction du nombre et des positions des prefix et suffix :</span>
            <span class="n">bp</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">BLOC_PREFIX</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">BLOC_SUFFIX</span>
            <span class="c1"># nombre d&#39;occurences des prefix et suffix :</span>
            <span class="n">prefix_count</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
            <span class="n">suffix_count</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
            <span class="c1"># positions attendues :</span>
            <span class="n">has_prefix</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
            <span class="n">has_suffix</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
            <span class="c1"># Cas idéal :</span>
            <span class="k">if</span> <span class="n">prefix_count</span> <span class="o">==</span> <span class="n">suffix_count</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">has_prefix</span> <span class="ow">and</span> <span class="n">has_suffix</span><span class="p">:</span>
                <span class="c1"># Bloc unique complet :</span>
                <span class="c1"># réduction du bloc :</span>
                <span class="n">requestpart</span> <span class="o">=</span> <span class="n">requestpart</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span> <span class="p">:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">bs</span><span class="p">)]</span>
                <span class="c1">#  recherche de données</span>
                <span class="n">numr</span> <span class="o">=</span> <span class="n">nbr</span> <span class="o">=</span> <span class="n">uniqueid</span> <span class="o">=</span> <span class="n">msglen</span> <span class="o">=</span> <span class="n">msgpart</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">parseerrors</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">nbpipe</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nbpipe</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">requestpart</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;|&quot;</span><span class="p">:</span>
                    <span class="n">parseerrors</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">nbpipe</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="c1"># On ne considère que les 4 premiers |</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">liste</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">stop</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">requestpart</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">liste</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">requestpart</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">])</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">liste</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">requestpart</span><span class="p">[</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:])</span>
                    <span class="n">liste2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">liste</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">liste2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="c1"># données invalides (requètes non numérotées)</span>
                        <span class="n">parseerrors</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">numr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">liste2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">nbr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">liste2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">uniqueid</span> <span class="o">=</span> <span class="n">liste</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">msglen</span> <span class="o">=</span> <span class="n">liste</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">msgpart</span> <span class="o">=</span> <span class="n">liste</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="c1"># le dict d&#39;infos du bloc :</span>
                <span class="n">parsedict</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;parseerrors&quot;</span><span class="p">:</span> <span class="n">parseerrors</span><span class="p">,</span>
                    <span class="s2">&quot;numr&quot;</span><span class="p">:</span> <span class="n">numr</span><span class="p">,</span>
                    <span class="s2">&quot;nbr&quot;</span><span class="p">:</span> <span class="n">nbr</span><span class="p">,</span>
                    <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="n">uniqueid</span><span class="p">,</span>
                    <span class="s2">&quot;msglen&quot;</span><span class="p">:</span> <span class="n">msglen</span><span class="p">,</span>
                    <span class="s2">&quot;msgpart&quot;</span><span class="p">:</span> <span class="n">msgpart</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Bloc incomplet ou données partielles de plusieurs blocs :</span>
                <span class="c1"># On sépare les données associées aux différents blocs</span>
                <span class="n">mixedblocs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
                    <span class="n">prefix_count</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
                    <span class="n">suffix_count</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">prefix_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">suffix_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># dernière donnée de bloc</span>
                        <span class="n">mixedblocs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">requestpart</span><span class="p">)</span>
                        <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">prefix_index</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
                        <span class="n">suffix_index</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">prefix_count</span> <span class="o">*</span> <span class="n">suffix_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="c1"># 2 dernières données de bloc</span>
                            <span class="k">if</span> <span class="n">prefix_index</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">lastblocs</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
                                <span class="n">lastblocs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bp</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lastblocs</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
                                <span class="n">lastblocs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">bs</span><span class="p">)</span>
                            <span class="n">mixedblocs</span> <span class="o">+=</span> <span class="n">lastblocs</span>
                            <span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">elif</span> <span class="n">prefix_index</span> <span class="o">&lt;</span> <span class="n">suffix_index</span><span class="p">:</span>
                            <span class="c1"># data + prefix + mixed</span>
                            <span class="n">seplist</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">mixedblocs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">seplist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bp</span><span class="p">]</span>
                            <span class="n">requestpart</span> <span class="o">=</span> <span class="n">seplist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># data + suffix + mixed</span>
                            <span class="n">seplist</span> <span class="o">=</span> <span class="n">requestpart</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">mixedblocs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">seplist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bs</span><span class="p">]</span>
                            <span class="n">requestpart</span> <span class="o">=</span> <span class="n">seplist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c1"># on enlève les éventuelles chaines vides</span>
                <span class="n">mixedblocs</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">mixedblocs</span> <span class="k">if</span> <span class="n">b</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>
                <span class="c1"># on reconstitue les blocs complets : bp, data, bs -&gt; bp + data + bs</span>
                <span class="n">blocslist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="n">newbloc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">for</span> <span class="n">bloc</span> <span class="ow">in</span> <span class="n">mixedblocs</span><span class="p">:</span>
                    <span class="n">newbloc</span> <span class="o">+=</span> <span class="n">bloc</span>
                    <span class="k">if</span> <span class="n">bloc</span> <span class="o">==</span> <span class="n">bs</span><span class="p">:</span>
                        <span class="n">blocslist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">newbloc</span><span class="p">))</span>
                        <span class="n">newbloc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newbloc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">blocslist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">newbloc</span><span class="p">))</span>
        <span class="c1"># retour :</span>
        <span class="k">return</span> <span class="n">valide</span><span class="p">,</span> <span class="n">parsedict</span><span class="p">,</span> <span class="n">blocslist</span>

    <span class="n">_parse_request_part</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">_parse_request_part</span><span class="p">)</span>

    <span class="c1">#-----&gt; Gestion des ERRNO réseau</span>
<div class="viewcode-block" id="CustomRequestHelper.is_error_fatal"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.is_error_fatal">[docs]</a>    <span class="k">def</span> <span class="nf">is_error_fatal</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Indique si l&#39;erreur reçue est fatale ou bien si l&#39;on peut ré essayer </span>
<span class="sd">        l&#39;action tentée.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            error (OSError ou autre)</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            boolean: False par défaut</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fatal</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">errno</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">ERRNO_DICT</span><span class="p">:</span>
                <span class="n">fatal</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">ERRNO_DICT</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;fatal&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fatal</span></div>

    <span class="n">is_error_fatal</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">is_error_fatal</span><span class="p">)</span>

    <span class="c1">#-----&gt; Tests</span>
<div class="viewcode-block" id="CustomRequestHelper.create_test_msg"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomRequestHelper.html#labpyproject.core.net.custom_TCP.CustomRequestHelper.create_test_msg">[docs]</a>    <span class="k">def</span> <span class="nf">create_test_msg</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">latin1</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crée un message de test d&#39;une longueur &gt; buffsize pour forcer l&#39;envoi</span>
<span class="sd">        de plusieurs blocs</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            confirmrecept (bool): ajoute le code d&#39;accusé de réception</span>
<span class="sd">            latin1 (bool): limite les caractères à la plage latin-1, plage unicode </span>
<span class="sd">                complète sinon</span>
<span class="sd">        </span>
<span class="sd">        Rq: les chars latin-1 sont codés 1 byte / char, les chars unicodes peuvent </span>
<span class="sd">        aller jusqu&#39;à 4 bytes / char mais peuvent lever une exception lors d&#39;un print </span>
<span class="sd">        (surrogates).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">latin1</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># caractères latin+1 uniquement</span>
            <span class="n">char_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">122</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># plage unicode complète</span>
            <span class="n">char_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1114111</span><span class="p">)</span>
        <span class="n">nbmin</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">BUFFERSIZE</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">nbmax</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">nbmin</span>
        <span class="n">list_int</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">char_range</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">nbmin</span><span class="p">,</span> <span class="n">nbmax</span><span class="p">))</span>
        <span class="n">list_letters</span> <span class="o">=</span> <span class="p">[</span><span class="nb">chr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">list_int</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">list_letters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">confirmrecept</span><span class="p">:</span>
            <span class="n">entete</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_cmd_msg</span><span class="p">(</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">NEED_CONFIRMATION</span>
            <span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">entete</span> <span class="o">+</span> <span class="n">msg</span>
        <span class="k">return</span> <span class="n">msg</span></div>

    <span class="n">create_test_msg</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span><span class="n">create_test_msg</span><span class="p">)</span></div>


<span class="c1">#-----&gt; Client &quot;from scratch&quot;</span>
<div class="viewcode-block" id="CustomTCPThreadedClient"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient">[docs]</a><span class="k">class</span> <span class="nc">CustomTCPThreadedClient</span><span class="p">(</span><span class="n">appcomp</span><span class="o">.</span><span class="n">NETComp</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    **Objet client** du serveur CustomTCPServerContainer</span>
<span class="sd">    </span>
<span class="sd">    Le client trace les données de connection vers le serveur. Il enregistre</span>
<span class="sd">    également les dernières erreurs survenues lors des connections, envois et réceptions.</span>
<span class="sd">    </span>
<span class="sd">    A chaque occurence d&#39;une action d&#39;envoi ou réception, le client envoie au composant</span>
<span class="sd">    business (appli métier), un dict d&#39;infos réseau via la méthode `dispatch_network_infos`.</span>

<span class="sd">    **Détection des problèmes de connections :**</span>
<span class="sd">    </span>
<span class="sd">    * client: analyse des erreurs en fonction de leur degré de gravité (même principe que </span>
<span class="sd">      le serveur frontal).</span>
<span class="sd">    * serveur: analyse des logs d&#39;envoi et réception (fonction des dernières erreurs et </span>
<span class="sd">      du nombre total d&#39;erreurs).</span>
<span class="sd">    </span>
<span class="sd">    Lorsque le statut du serveur passe à `CustomRequestHelper.STATUS_UNDEFINED` on le considère</span>
<span class="sd">    comme probablement déconnecté. Dans ce cas les prochaines tentatives d&#39;envoi se limiteront </span>
<span class="sd">    à un essai. Charge à l&#39;appli métier de décider de considérer définitivement le serveur comme </span>
<span class="sd">    déconnecté.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># méthodes :</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_address</span><span class="p">,</span> <span class="n">externalhandler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_connect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructeur</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            server_address (tuple)</span>
<span class="sd">            externalhandler (function): fonction externe appelée à l&#39;issue du traitement </span>
<span class="sd">                d&#39;une requète entrante</span>
<span class="sd">            auto_connect (Boolean): connection automatique à l&#39;initialisation</span>
<span class="sd">        </span>
<span class="sd">        Rq: externalhandler est une option, utiliser de préférence le mécanisme par défaut </span>
<span class="sd">        de Queues hérité de app_components</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Init superclasse appcomp.NETComp :</span>
        <span class="n">appcomp</span><span class="o">.</span><span class="n">NETComp</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># handler externe (méthode éxécutable) optionnel (communication native avec les </span>
        <span class="c1"># autres composants via un mécanisme de gestion automatique de Queues multi canaux)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span> <span class="o">=</span> <span class="n">externalhandler</span>
        <span class="c1"># unique id de client :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># socket entrante (read) :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket_read</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host_read</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port_read</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binded_to_read</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># thread de réception :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_read_active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_read</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># nombre de threads internes :</span>
        <span class="c1"># thread_read ne peut être démarré qu&#39;en cours de connection, on le &quot;masque&quot; donc</span>
        <span class="c1"># au process générique de APPComp. Le fait qu&#39;il ne soit pas joint ne pose pas de problèmes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_childthreads_count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># socket sortante (write) :</span>
        <span class="c1"># Rq le thread write est en fait le thread principal de ce composant,</span>
        <span class="c1"># soit self.own_thread (voir appcomp.ThreadableComp)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected_to_server</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refused_by_server</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># dict d&#39;infos réseau :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_net_dict</span><span class="p">()</span>
        <span class="c1"># liste d&#39;ids uniques de messages reçus :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_received_msguids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="c1"># indicateur d&#39;activité du thread principal du composant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_write_active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Adresse :</span>
        <span class="k">if</span> <span class="n">server_address</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span> <span class="o">=</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">=</span> <span class="n">server_address</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># lance le process de connection :</span>
        <span class="k">if</span> <span class="n">auto_connect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_net_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise le dict de logs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;connected&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;refused&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;connection_status&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span><span class="p">,</span>
            <span class="s2">&quot;server_status&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;client&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;read_address&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;binded&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;last_connect_send_error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;connect_send_error_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;last_send_error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;send_error_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;last_connect_receive_error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;connect_receive_error_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;last_receive_error&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;receive_error_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;uncomplete_received_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;unit_sended_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;AR_sended_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;total_sended_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;unit_received_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;AR_received_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;total_received_request_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="c1">#-----&gt; uid</span>
    <span class="k">def</span> <span class="nf">_set_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_uid</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_get_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uid</span>

    <span class="n">uid</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">_get_uid</span><span class="p">,</span> <span class="n">_set_uid</span>
    <span class="p">)</span>  <span class="c1">#: identifiant unique du client (défini par le serveur)</span>

    <span class="c1">#-----&gt; Surcharge de appcomp.NETComp</span>
<div class="viewcode-block" id="CustomTCPThreadedClient.on_component_thread_started"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.on_component_thread_started">[docs]</a>    <span class="k">def</span> <span class="nf">on_component_thread_started</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pseudo événement : indique que le thread principal du composant est démarré</span>
<span class="sd">        (Méthode de appcomp.ThreadableComp)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_write_active</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="CustomTCPThreadedClient.sendFromExchangeObject"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.sendFromExchangeObject">[docs]</a>    <span class="k">def</span> <span class="nf">sendFromExchangeObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Méthode d&#39;envoi à partir des données comprises dans l&#39;objet NETExchangeObject</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (NETExchangeObject): objet d&#39;échange </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictargs</span> <span class="o">=</span> <span class="n">exobj</span><span class="o">.</span><span class="n">dictargs</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;msg&quot;</span><span class="p">]</span>
        <span class="n">confirmrecept</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="s2">&quot;confirmrecept&quot;</span> <span class="ow">in</span> <span class="n">dictargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">confirmrecept</span> <span class="o">=</span> <span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;confirmrecept&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomTCPThreadedClient.set_address"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.set_address">[docs]</a>    <span class="k">def</span> <span class="nf">set_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Affecte l&#39;adresse d&#39;écoute du serveur / adresse d&#39;écriture du client.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (NETExchangeObject): objet d&#39;échange avec </span>
<span class="sd">                exobj.dictargs={&quot;host&quot;:, &quot;port&quot;:}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictargs</span> <span class="o">=</span> <span class="n">exobj</span><span class="o">.</span><span class="n">dictargs</span>
        <span class="n">host</span> <span class="o">=</span> <span class="n">port</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;host&quot;</span> <span class="ow">in</span> <span class="n">dictargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="s2">&quot;port&quot;</span> <span class="ow">in</span> <span class="n">dictargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dictargs</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">host</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">port</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span> <span class="o">=</span> <span class="n">host</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">=</span> <span class="n">port</span></div>

<div class="viewcode-block" id="CustomTCPThreadedClient.connect"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.connect">[docs]</a>    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ordre de connection à l&#39;adresse pré définie ou à l&#39;adresse éventuellement</span>
<span class="sd">        indiquée dans exobj.dictargs={&quot;host&quot;:, &quot;port&quot;:}</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (NETExchangeObject): objet d&#39;échange </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># En fonction du statut :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Re définition éventuelle de l&#39;adresse :</span>
        <span class="k">if</span> <span class="n">exobj</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_address</span><span class="p">(</span><span class="n">exobj</span><span class="p">)</span>
        <span class="c1"># Connexion :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_write_process</span><span class="p">()</span></div>

<div class="viewcode-block" id="CustomTCPThreadedClient.disconnect"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.disconnect">[docs]</a>    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ordre de déconnexion.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (NETExchangeObject): objet d&#39;échange </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># envoi du message de déconnection au serveur :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_cmd_msg</span><span class="p">(</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_DISCONNECTED</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Nettoyage :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_internal</span><span class="p">()</span>
        <span class="c1"># Etat :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span>
        <span class="c1"># Informe le composant business:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Le client est déconnecté.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomTCPThreadedClient.net_shutdown"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.net_shutdown">[docs]</a>    <span class="k">def</span> <span class="nf">net_shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exobj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ordre de clôture du réseau.</span>
<span class="sd">        </span>
<span class="sd">        Rq : on ne clôt pas le process de gestion de tâches, le client est</span>
<span class="sd">        complètement ré initialisé, mais peut être redémarré.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exobj (NETExchangeObject): objet d&#39;échange </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_net_shutdown_internal</span><span class="p">()</span></div>

<div class="viewcode-block" id="CustomTCPThreadedClient.shutdown"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.shutdown">[docs]</a>    <span class="k">def</span> <span class="nf">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clôture définitive du composant propagé par APPComp.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># arrêt / ré initialisation du client :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_net_shutdown_internal</span><span class="p">()</span>
        <span class="c1"># générique : arrêt du process d&#39;écoute des tâches</span>
        <span class="n">appcomp</span><span class="o">.</span><span class="n">NETComp</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_net_shutdown_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Code générque de clôture.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># envoi du message d&#39;arrêt au serveur :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_cmd_msg</span><span class="p">(</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_SHUTDOWN</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Etat :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_SHUTDOWN</span>
        <span class="c1"># Informe le composant business:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Le client est arrêté.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># Nettoyage :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_close_internal</span><span class="p">()</span>
        <span class="c1"># Ré initialisation :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refused_by_server</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_net_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">#-----&gt; Méthodes internes au framework</span>
    <span class="c1">#-----&gt; Envoi de message</span>
<div class="viewcode-block" id="CustomTCPThreadedClient.send"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.send">[docs]</a>    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Envoie msg au serveur avec accusé de réception par défaut.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): message à envoyer</span>
<span class="sd">            confirmrecept (boolean): avec accusé de réception?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1- Préparation du message</span>
        <span class="c1"># identifiant unique de message :</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">mark_msg_as_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="c1"># AR :</span>
        <span class="n">msg2send</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="k">if</span> <span class="n">confirmrecept</span><span class="p">:</span>
            <span class="n">msg2send</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">prefix_msg_with_code</span><span class="p">(</span>
                <span class="n">msg2send</span><span class="p">,</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">NEED_CONFIRMATION</span>
            <span class="p">)</span>
        <span class="c1"># 2- envoi :</span>
        <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">msg2send</span><span class="p">)</span>
        <span class="c1"># 3- Retour</span>
        <span class="c1"># Etat réseau -&gt; application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_infos</span><span class="p">()</span>
        <span class="c1"># signalement d&#39;erreur :</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
            <span class="c1"># retour systématique quelques soient les statuts de connection</span>
            <span class="n">logargs</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span>
                <span class="s2">&quot;confirmrecept&quot;</span><span class="p">:</span> <span class="n">confirmrecept</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">exobj</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="p">(</span>
                <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="o">.</span><span class="n">SEND_ERROR</span><span class="p">,</span> <span class="n">logargs</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendTask</span><span class="p">(</span><span class="n">exobj</span><span class="p">)</span></div>

    <span class="c1">#-----&gt; Clôture des sockets et arrêt des threads</span>
    <span class="k">def</span> <span class="nf">_close_internal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Méthode de fermeture (cloture des sockets) appelée lors de la </span>
<span class="sd">        fermeture du serveur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_read_active</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread_read_active</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_read</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_read</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_receive</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_write_active</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread_write_active</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_send</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected_to_server</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binded_to_read</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1">#-----&gt; Initialisation et gestion des envois de requètes vers le serveur</span>
    <span class="k">def</span> <span class="nf">_start_write_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initie le process d&#39;écriture.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># connection initiale :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connect_to_write</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_connect_to_write</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connecte ou reconnecte (avec un port différent) socket_write au serveur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Fermeture &quot;propre&quot; :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span><span class="o">.</span><span class="n">shutdown</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SHUT_RDWR</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_send</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="c1"># (re) création :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Boucle de tentatives de connection :</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">connection_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">connected</span>
            <span class="ow">and</span> <span class="n">connection_count</span> <span class="o">&lt;</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONNECTION_MAX_COUNT</span>
        <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">server_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_send</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connected_to_server</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_ERROR_CONNECTION</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_ERROR_CONNECTION</span>
                <span class="n">connection_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">RECONNECTION_DELAY</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connected_to_server</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span>
                <span class="c1"># Informe le composant business:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Le client est connecté.&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ask_server_for_uid</span><span class="p">()</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_read_active</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="c1"># on essaye de lancer à nouveau le process d&#39;écoute :</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_start_read_process</span><span class="p">()</span>
        <span class="c1"># Tentatives infructueuses on transmet l&#39;info :</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">connected</span><span class="p">:</span>
            <span class="c1"># Remontée de l&#39;erreur</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Impossible de se connecter au serveur à l&#39;adresse : &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_host</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_port</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ask_server_for_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Demande au serveur d&#39;affecter à ce client un uniqueId.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># marqueur d&#39;erreur :</span>
        <span class="n">has_error</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># 1- envoi d&#39;une requète d&#39;identification unique</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_cmd_msg</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">ASK_FOR_UID</span><span class="p">)</span>
        <span class="n">list2send</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_indexed_request</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">send_indexed_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span><span class="p">,</span> <span class="n">list2send</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_sended_request_count</span><span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># l&#39;envoi a échoué :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_send</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># envoi réussi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># 2- Réception de la réponse du serveur</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_error</span><span class="p">:</span>
            <span class="n">dictreceive</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">receive_indexed_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span><span class="p">)</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span>
            <span class="n">complete</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;complete&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">#  réponse invalide</span>
                <span class="n">error</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">complete</span><span class="p">)</span>
                <span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># réponse valide</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">complete</span><span class="p">)</span>
                <span class="n">reponse</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msg_except_cmd&quot;</span><span class="p">]</span>
                <span class="n">code_cmd</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;code_cmd&quot;</span><span class="p">]</span>
                <span class="n">msguid</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msguid&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_received_request_count</span><span class="p">(</span><span class="n">msguid</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="c1"># Traitement de la réponse du serveur :</span>
                <span class="k">if</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONNECTION_REFUSED</span><span class="p">:</span>
                    <span class="c1"># connection refusée par le serveur :</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_to_external_handler</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;netcode&quot;</span><span class="p">:</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONNECTION_REFUSED</span><span class="p">}</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connected_to_server</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">refused_by_server</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="c1"># Infos réseau -&gt; application</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_infos</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">refused_by_server</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">reponse</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">reponse</span>
                        <span class="c1"># appel du handler externe :</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_to_external_handler</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                                <span class="s2">&quot;netcode&quot;</span><span class="p">:</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">UID_SET_BY_SERVER</span><span class="p">,</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                        <span class="c1"># on défini le port d&#39;écoute initial :</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_create_read_address</span><span class="p">()</span>
                        <span class="c1"># on essaye de lancer le process d&#39;écoute immédiatement :</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_start_read_process</span><span class="p">()</span>
        <span class="c1"># 3- Gestion d&#39;erreur</span>
        <span class="k">if</span> <span class="n">has_error</span><span class="p">:</span>
            <span class="c1"># on retente dans la limite de CustomRequestHelper.SEND_MAX_COUNT</span>
            <span class="c1"># sans mesurer la gravité de l&#39;erreur</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SEND_MAX_COUNT</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">RESEND_DELAY</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ask_server_for_uid</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_send_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Envoi d&#39;un message au serveur via la socket socket_write.</span>
<span class="sd">        </span>
<span class="sd">        Return:</span>
<span class="sd">            done (bool): indicateur de réussite</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span><span class="p">:</span>
            <span class="c1"># re-connection obligatoire (le serveur clôture systématiquement les sockets)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connect_to_write</span><span class="p">()</span>
            <span class="c1"># en cas d&#39;échec</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_to_server</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="c1"># gestion de l&#39;AR :</span>
            <span class="n">confirmrecept</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">code_cmd</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">split_cmd_and_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">code_cmd</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">NEED_CONFIRMATION</span><span class="p">,</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SET_CLIENT_READ_INFOS</span><span class="p">,</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_CONNECTED</span><span class="p">,</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_DISCONNECTED</span><span class="p">,</span>
                <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CLIENT_SHUTDOWN</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="n">confirmrecept</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># nombre de tentatives :</span>
            <span class="n">maxcount</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SEND_MAX_COUNT</span>
            <span class="k">if</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SET_CLIENT_READ_INFOS</span><span class="p">:</span>
                <span class="n">maxcount</span> <span class="o">*=</span> <span class="mi">5</span>
            <span class="c1"># log quantitatif envoi :</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_sended_request_count</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">confirmrecept</span><span class="p">)</span>
            <span class="c1"># marqueur d&#39;erreur :</span>
            <span class="n">has_error</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># 1- Envoi de la requête :</span>
            <span class="n">msglen</span><span class="p">,</span> <span class="n">list2send</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_indexed_request</span><span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span>
            <span class="p">)</span>
            <span class="n">error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">send_indexed_request</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span><span class="p">,</span> <span class="n">list2send</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># l&#39;envoi a échoué :</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_send</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                <span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># envoi réussi</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="c1"># 2- test de réception :</span>
            <span class="k">if</span> <span class="n">confirmrecept</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_error</span><span class="p">:</span>
                <span class="n">dictreceive</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">receive_indexed_request</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">socket_write</span>
                <span class="p">)</span>
                <span class="n">errors</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span>
                <span class="n">complete</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;complete&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#  réponse invalide</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">complete</span><span class="p">)</span>
                    <span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># réponse valide</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">complete</span><span class="p">)</span>
                    <span class="n">bytesreceived</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msg_except_cmd&quot;</span><span class="p">]</span>
                    <span class="n">code_cmd</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;code_cmd&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONNECTION_REFUSED</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_REJECTED</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Connection refusée par le serveur.&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_status</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                        <span class="k">return</span>
                    <span class="k">elif</span> <span class="p">(</span>
                        <span class="n">code_cmd</span> <span class="o">!=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONFIRM_RECEPTION</span>
                        <span class="ow">or</span> <span class="n">bytesreceived</span> <span class="o">==</span> <span class="kc">None</span>
                        <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">bytesreceived</span><span class="p">)</span> <span class="o">!=</span> <span class="n">msglen</span>
                    <span class="p">):</span>
                        <span class="c1"># réception non confirmée</span>
                        <span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># log quantitatif réception :</span>
                        <span class="n">msguid</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msguid&quot;</span><span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_received_request_count</span><span class="p">(</span><span class="n">msguid</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="c1"># 3- Gestion d&#39;erreur</span>
            <span class="k">if</span> <span class="n">has_error</span><span class="p">:</span>
                <span class="c1"># Est ce raisonnable de ré essayer ?</span>
                <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fatal_error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">is_error_fatal</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">fatal_error</span><span class="p">:</span>
                        <span class="c1"># inutile : on arrête</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="c1"># erreur lors de l&#39;envoi ou de la réception de l&#39;accusé de réception</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">maxcount</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">RESEND_DELAY</span><span class="p">)</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
            <span class="c1"># 4- retour final :</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">has_error</span>

    <span class="c1">#-----&gt; Gestion de l&#39;écoute des requètes envoyées par le serveur</span>
    <span class="k">def</span> <span class="nf">_start_read_process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Après affectation de l&#39;uid, met en place le processus d&#39;écoute du serveur sur </span>
<span class="sd">        socket_read.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket_read</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">socket_read</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Boucle de tentatives de connection :</span>
        <span class="n">connection_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">connected</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">connected</span>
            <span class="ow">and</span> <span class="n">connection_count</span> <span class="o">&lt;</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONNECTION_MAX_COUNT</span>
        <span class="p">):</span>
            <span class="c1"># Si self.port_read est occupé on prend le suivant etc... :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">port_read</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">port_read</span> <span class="o">+</span> <span class="n">connection_count</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_read</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">host_read</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port_read</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># la socket est occupée, on relance le process en incrémentant le port :</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binded_to_read</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_receive</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">connection_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">RECONNECTION_DELAY</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">connected</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_receive</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="c1"># Lance le process d&#39;écoute :</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">socket_read</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">thread_read_active</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">binded_to_read</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_listen_to_server</span><span class="p">()</span>
                <span class="c1"># Informe le serveur que la connection est activée :</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_server_client_read_infos</span><span class="p">()</span>
        <span class="c1"># Infos réseau -&gt; application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_infos</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_create_read_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Génère l&#39;adresse d&#39;écoute du serveur :</span>
<span class="sd">        </span>
<span class="sd">        * en local (server_host=&#39;&#39; ou &#39;localhost&#39;) : prend le même hôte, et ajoute à </span>
<span class="sd">          son port une quantité dérivée de l&#39;uid. Chaque client local a sa propre plage </span>
<span class="sd">          de ports locaux (largeur = 200).</span>
<span class="sd">        * en ligne : choisi au hasard n&#39;importe quel port entre 10000 et 20000        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_host</span> <span class="o">==</span> <span class="s2">&quot;localhost&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">host_read</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">port_read</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span> <span class="o">+</span> <span class="mi">200</span> <span class="o">*</span> <span class="n">num</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">host_read</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">get_ip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">port_read</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">20000</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_server_client_read_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transmet au serveur les données de connexion à socket_read.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_cmd_msg</span><span class="p">(</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SET_CLIENT_READ_INFOS</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_read</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">port_read</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_listen_to_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lance le process d&#39;écoute du serveur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread_read</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_child_thread</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_read_thread_loop</span><span class="p">,</span> <span class="n">suffixname</span><span class="o">=</span><span class="s2">&quot;clt_read&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_thread_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;Boucle&quot; d&#39;écoute du serveur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">connections_distantes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread_read_active</span><span class="p">:</span>
            <span class="c1"># Le serveur a t&#39;il fait une demande de connexion ?</span>
            <span class="n">connexions_demandees</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">socket_read</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SELECT_TIMEOUT</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">connexion</span> <span class="ow">in</span> <span class="n">connexions_demandees</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">connexion_avec_client</span> <span class="o">=</span> <span class="n">connexion</span><span class="o">.</span><span class="n">accept</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">connections_distantes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connexion_avec_client</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_receive</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="c1"># Le serveur a t&#39;il envoyé un message?</span>
            <span class="n">sock_to_read</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sock_to_read</span> <span class="o">=</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                    <span class="n">connections_distantes</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SELECT_TIMEOUT</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># rq : python 3.3 select.error devient OSError</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_connect_receive</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># On reçoit les messages :</span>
                <span class="k">for</span> <span class="n">sock</span> <span class="ow">in</span> <span class="n">sock_to_read</span><span class="p">:</span>
                    <span class="c1"># 1- Réception des données :</span>
                    <span class="n">dictreceive</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">receive_indexed_request</span><span class="p">(</span><span class="n">sock</span><span class="p">)</span>
                    <span class="c1"># 2- Traitement du message (dont logs):</span>
                    <span class="n">dicthandle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_server_msg</span><span class="p">(</span><span class="n">dictreceive</span><span class="p">)</span>
                    <span class="c1"># 3- On retourne la réponse (le nombre de caractères du message reçu par défaut)</span>
                    <span class="k">if</span> <span class="n">dicthandle</span><span class="p">[</span><span class="s2">&quot;reply&quot;</span><span class="p">]:</span>
                        <span class="n">list2send</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">create_indexed_request</span><span class="p">(</span>
                            <span class="n">dicthandle</span><span class="p">[</span><span class="s2">&quot;reponse&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span>
                        <span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">send_indexed_request</span><span class="p">(</span>
                            <span class="n">sock</span><span class="p">,</span> <span class="n">list2send</span>
                        <span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_log_send</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_server_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dictreceive</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traite un message du serveur reçu sur la socket read</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            dictreceive : dict généré par CustomRequestHelper.receive_indexed_request</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            dict: {&quot;reply&quot;:Bool, &quot;reponse&quot;:}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dispatch_msg</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">dispatch_infos</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Logs :</span>
        <span class="n">complete</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;complete&quot;</span><span class="p">]</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">complete</span><span class="p">)</span>
            <span class="n">dispatch_msg</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">complete</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">complete</span><span class="p">:</span>
            <span class="n">dispatch_msg</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Filtrage des requêtes nulles (cas d&#39;un serveur déconnecté sauvagement)</span>
        <span class="c1"># ou non décodées (décodage unicode en erreur)</span>
        <span class="n">msguid</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msguid&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msguid</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># retournera un AR en erreur (len(msg)=0)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;reply&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;reponse&quot;</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">}</span>
        <span class="c1"># Traitement</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msg&quot;</span><span class="p">]</span>
        <span class="n">msg_except_cmd</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;msg_except_cmd&quot;</span><span class="p">]</span>
        <span class="n">code_cmd</span> <span class="o">=</span> <span class="n">dictreceive</span><span class="p">[</span><span class="s2">&quot;code_cmd&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">len_msg</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">len_msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
        <span class="c1"># retour par défaut :</span>
        <span class="n">do_reply</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">do_close</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">reponse</span> <span class="o">=</span> <span class="n">len_msg</span>
        <span class="n">return_code</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># accusé de réception :</span>
        <span class="k">if</span> <span class="n">code_cmd</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">NEED_CONFIRMATION</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_CONNECTED</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_DISCONNECTED</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_SHUTDOWN</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">PING</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="c1"># Envoi d&#39;un accusé de réception</span>
            <span class="n">do_reply</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">return_code</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">CONFIRM_RECEPTION</span>
            <span class="n">reponse</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">prefix_msg_with_code</span><span class="p">(</span><span class="n">reponse</span><span class="p">,</span> <span class="n">return_code</span><span class="p">)</span>
        <span class="c1"># Traitement des commandes spéciales de la forme &quot;[cmd:CODE_CMD]&quot;</span>
        <span class="k">if</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_CONNECTED</span><span class="p">:</span>
            <span class="c1"># le serveur se reconnecte :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span>
            <span class="n">dispatch_msg</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">dispatch_infos</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_DISCONNECTED</span><span class="p">:</span>
            <span class="c1"># le serveur se déconnecte</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span>
            <span class="n">dispatch_msg</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">dispatch_infos</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">SERVER_SHUTDOWN</span><span class="p">:</span>
            <span class="c1"># le serveur va se fermer définitivement, on arrête :</span>
            <span class="n">do_close</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_SHUTDOWN</span>
            <span class="n">dispatch_msg</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">dispatch_infos</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">PING</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># appel du handler externe :</span>
        <span class="k">if</span> <span class="n">dispatch_msg</span><span class="p">:</span>
            <span class="c1"># optimisation : propagation uniquement si la requête est complète et sans erreurs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_to_external_handler</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span> <span class="s2">&quot;netcode&quot;</span><span class="p">:</span> <span class="n">code_cmd</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg_except_cmd</span><span class="p">}</span>
            <span class="p">)</span>
        <span class="c1"># logs quantitatifs :</span>
        <span class="c1"># - réception</span>
        <span class="n">hasAR</span> <span class="o">=</span> <span class="n">code_cmd</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">NEED_CONFIRMATION</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_received_request_count</span><span class="p">(</span><span class="n">msguid</span><span class="p">,</span> <span class="n">hasAR</span><span class="p">)</span>
        <span class="c1"># - envoi</span>
        <span class="k">if</span> <span class="n">do_reply</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_sended_request_count</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="c1"># retour par défaut :</span>
        <span class="k">if</span> <span class="n">do_close</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Infos réseau -&gt; application</span>
        <span class="k">if</span> <span class="n">dispatch_infos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_infos</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;reply&quot;</span><span class="p">:</span> <span class="n">do_reply</span><span class="p">,</span> <span class="s2">&quot;reponse&quot;</span><span class="p">:</span> <span class="n">reponse</span><span class="p">}</span>

    <span class="c1">#-----&gt; Retour interne au framework</span>
<div class="viewcode-block" id="CustomTCPThreadedClient.dispatch_to_external_handler"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.dispatch_to_external_handler">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_to_external_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dicthandler</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transmission à l&#39;application associée en toute fin du traitement de la requète</span>
<span class="sd">        </span>
<span class="sd">        - de préférence via le mécanisme de Queues hérité de app_components </span>
<span class="sd">          (via queue_tools)</span>
<span class="sd">        - sinon via self.externalhandler en appel direct s&#39;il est défini</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># transmission à l&#39;application :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_queues_active</span><span class="p">():</span>
            <span class="c1"># de préférence via le mécanisme de Queues :</span>
            <span class="n">exobj</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="p">(</span>
                <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="o">.</span><span class="n">RECEIVE</span><span class="p">,</span> <span class="n">dicthandler</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendTask</span><span class="p">(</span><span class="n">exobj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">):</span>
            <span class="c1"># appel direct au handler externe sinon :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">(</span><span class="n">dicthandler</span><span class="p">)</span></div>

    <span class="c1">#-----&gt; Logs</span>
    <span class="k">def</span> <span class="nf">_log_connect_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connect_error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log de la dernière tentative de connection d&#39;envoi</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">            connect_error : OSError ou None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;last_connect_send_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">connect_error</span>
        <span class="k">if</span> <span class="n">connect_error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;connect_send_error_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_client_status_on_error</span><span class="p">(</span><span class="n">connect_error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">send_error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log du dernier essai d&#39;envoi au serveur</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            send_error : OSError ou None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;last_send_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">send_error</span>
        <span class="k">if</span> <span class="n">send_error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;send_error_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_client_status_on_error</span><span class="p">(</span><span class="n">send_error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_sended_request_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">hasAR</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log les envois de requête vers le serveur :</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            unit : est-ce un envoi unitaire ou bien un renvoi</span>
<span class="sd">            hasAR : si unit=True, indique si la requête nécessite un accusé de récpetion          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;total_sended_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">unit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;unit_sended_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">hasAR</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;AR_sended_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_log_connect_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connect_error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log de la dernière tentative de connection de réception</span>
<span class="sd">        connect_error : OSError ou None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;last_connect_receive_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">connect_error</span>
        <span class="k">if</span> <span class="n">connect_error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;connect_receive_error_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_client_status_on_error</span><span class="p">(</span><span class="n">connect_error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receive_error</span><span class="p">,</span> <span class="n">complete</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log du dernier essai d&#39;envoi au serveur</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            receive_error : OSError ou None</span>
<span class="sd">            complete (boolean)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;last_receive_error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">receive_error</span>
        <span class="k">if</span> <span class="n">receive_error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;receive_error_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;uncomplete_received_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="ow">not</span> <span class="n">complete</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_client_status_on_error</span><span class="p">(</span><span class="n">receive_error</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_received_request_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msguid</span><span class="p">,</span> <span class="n">hasAR</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log les réceptions de messages envoyés par le serveur</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msguid : identifiant unique de message</span>
<span class="sd">            hasAR : un accusé de réception est-il demandé.        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;total_received_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">msguid</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">msguid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_received_msguids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;unit_received_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">hasAR</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="s2">&quot;AR_received_request_count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">msguid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_received_msguids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_received_msguids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msguid</span><span class="p">)</span>

    <span class="c1">#-----&gt; Analyse d&#39;erreurs</span>
    <span class="k">def</span> <span class="nf">_check_client_status_on_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Met à jour son statut en fonction de la nature de l&#39;erreur.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            error: OSError ou ParseDataError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prev_states</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_status</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fatal_error</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">is_error_fatal</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fatal_error</span><span class="p">:</span>
                <span class="c1"># on passe le client en statut CustomRequestHelper.STATUS_ERROR_CONNECTION</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_ERROR_CONNECTION</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span><span class="p">:</span>
                <span class="c1"># on passe le client en statut CustomRequestHelper.STATUS_UNDEFINED</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_UNDEFINED</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_detect_server_state</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_SHUTDOWN</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span>
            <span class="c1"># self.server_status = CustomRequestHelper.STATUS_CONNECTED</span>
        <span class="c1"># Envoi conditionnel des infos réseau : évite de mettre constamment à jour</span>
        <span class="c1"># la GUI lorsque le serveur est déconnecté.</span>
        <span class="n">new_states</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_status</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new_states</span> <span class="o">!=</span> <span class="n">prev_states</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_infos</span><span class="p">()</span>

    <span class="c1">#-----&gt; Etat du réseau</span>
<div class="viewcode-block" id="CustomTCPThreadedClient.dispatch_network_status"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.dispatch_network_status">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_network_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Informe le composant business de l&#39;état de connection</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg : message d&#39;info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;connection_status&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="p">}</span>
        <span class="c1"># transmission à l&#39;application :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_queues_active</span><span class="p">():</span>
            <span class="c1"># de préférence via le mécanisme de Queues :</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="o">.</span><span class="n">NET_STATUS</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span> <span class="o">==</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_ERROR_CONNECTION</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="o">.</span><span class="n">NET_ERROR</span>
            <span class="n">exobj</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">dictargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendTask</span><span class="p">(</span><span class="n">exobj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">):</span>
            <span class="c1"># appel direct au handler externe sinon :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">(</span><span class="n">dictargs</span><span class="p">)</span>
        <span class="c1"># Infos réseau -&gt; application</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_network_infos</span><span class="p">()</span></div>

<div class="viewcode-block" id="CustomTCPThreadedClient.dispatch_network_infos"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.dispatch_network_infos">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_network_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Envoi au composant Business les infos réseau.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dictargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_network_infos</span><span class="p">()</span>
        <span class="c1"># transmission à l&#39;application :</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">are_queues_active</span><span class="p">():</span>
            <span class="c1"># de préférence via le mécanisme de Queues :</span>
            <span class="n">exobj</span> <span class="o">=</span> <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="p">(</span>
                <span class="n">appcomp</span><span class="o">.</span><span class="n">NETExchangeObject</span><span class="o">.</span><span class="n">SET_NET_INFO</span><span class="p">,</span> <span class="n">dictargs</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendTask</span><span class="p">(</span><span class="n">exobj</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">):</span>
            <span class="c1"># appel direct au handler externe sinon :</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">externalhandler</span><span class="p">(</span><span class="n">dictargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CustomTCPThreadedClient.get_network_infos"><a class="viewcode-back" href="../../../../api/labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.html#labpyproject.core.net.custom_TCP.CustomTCPThreadedClient.get_network_infos">[docs]</a>    <span class="k">def</span> <span class="nf">get_network_infos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mise à jour des infos réseau.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Serveur :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;address&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;connected&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_to_server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;refused&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refused_by_server</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;connection_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s2">&quot;server_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span>
        <span class="c1"># Client :</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;client&quot;</span><span class="p">][</span><span class="s2">&quot;read_address&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host_read</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port_read</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;client&quot;</span><span class="p">][</span><span class="s2">&quot;binded&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binded_to_read</span>
        <span class="c1"># Erreurs : mises à jour via les logs</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span></div>

    <span class="k">def</span> <span class="nf">_detect_server_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identifie la possible déconnection &quot;sauvage&quot; du serveur.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">netdict</span><span class="p">[</span><span class="s2">&quot;errors&quot;</span><span class="p">]</span>
        <span class="c1"># envoi :</span>
        <span class="n">last_con_send</span> <span class="o">=</span> <span class="n">nd</span><span class="p">[</span><span class="s2">&quot;last_connect_send_error&quot;</span><span class="p">]</span>
        <span class="n">last_send</span> <span class="o">=</span> <span class="n">nd</span><span class="p">[</span><span class="s2">&quot;last_send_error&quot;</span><span class="p">]</span>
        <span class="n">fact_send</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">last_con_send</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">last_send</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">nb_send</span> <span class="o">=</span> <span class="n">nd</span><span class="p">[</span><span class="s2">&quot;send_error_count&quot;</span><span class="p">]</span>
        <span class="n">test_send</span> <span class="o">=</span> <span class="n">fact_send</span> <span class="o">*</span> <span class="n">nb_send</span> <span class="o">&gt;</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">INACTIVE_COUNT</span>
        <span class="c1"># réception</span>
        <span class="n">last_con_rec</span> <span class="o">=</span> <span class="n">nd</span><span class="p">[</span><span class="s2">&quot;last_connect_receive_error&quot;</span><span class="p">]</span>
        <span class="n">last_rec</span> <span class="o">=</span> <span class="n">nd</span><span class="p">[</span><span class="s2">&quot;last_receive_error&quot;</span><span class="p">]</span>
        <span class="n">fact_rec</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">last_con_rec</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">last_rec</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">nb_rec</span> <span class="o">=</span> <span class="n">nd</span><span class="p">[</span><span class="s2">&quot;receive_error_count&quot;</span><span class="p">]</span>
        <span class="n">test_receive</span> <span class="o">=</span> <span class="n">fact_rec</span> <span class="o">*</span> <span class="n">nb_rec</span> <span class="o">&gt;</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">INACTIVE_COUNT</span>
        <span class="c1"># détection d&#39;un déconnection &quot;sauvage&quot; du serveur :</span>
        <span class="k">if</span> <span class="n">test_send</span> <span class="ow">or</span> <span class="n">test_receive</span><span class="p">:</span>
            <span class="c1"># on peut considérer que le serveur s&#39;est déconnecté sauvagement</span>
            <span class="c1"># limite les prochaines tentatives de connection/réception à un essai</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_UNDEFINED</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_SHUTDOWN</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_DISCONNECTED</span><span class="p">,</span>
            <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_ERROR_CONNECTION</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="c1"># on suppose le serveur connecté</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">server_status</span> <span class="o">=</span> <span class="n">CustomRequestHelper</span><span class="o">.</span><span class="n">STATUS_CONNECTED</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Gabriel Leroy - novembre 2020 - Licence Art Libre (https://artlibre.org/)

    </p>
  </div>
    
    
    
    Compilé avec <a href="http://sphinx-doc.org/">Sphinx</a> en utilisant un
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">thème</a>
    
    fourni par <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>